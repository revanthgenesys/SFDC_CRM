@isTest
public class TestNewSubscriptionComponentController {
    static Account Acc;
    static Contact con;
    static Opportunity Opp;
    static BigMachines__Quote__c quote;
    static Order__c ord;
    static Subscription__c subscrb;
    static Cloud_Deployment__c Cdeploy;
    static Order__c ord2;
    static Subscription__c subscrb2;
    static Subscription_Request_Log__c SRL;
    static LMS_License_Types__c license;
    static LMS_ProductLine__c LMSProdLine;
    static LMS_ProductName__c PrdName;
    
    static string LicenceText='<?xml version="1.0"?><LicenseFiles><LicenseFile company="Avtex" companyId="001U000000YdGkTIAV" genesysId="51777" bundle="CIC 4.0 Production Bundle" identifier="FBF1AE23-B4EF-454D-BA2A-ED7CB32CE32C" productLine="CIC 4.0" version="4.0" replaceLicense="True"><Description>Used in production settings. Licenses are generated by selecting Ordered Items from the Account Summary.</Description><Type>Trial</Type><Features><Feature name="I3_FEATURE_SIP" /><Feature name="I3_FEATURE_IPA" /><Feature name="I3_FEATURE_ICELIB_SDK" /><Feature name="I3_FEATURE_MEDIA_SERVERS" /><Feature name="I3_FEATURE_ATTENDANT_REMOTE_DATA_QUERY" /><Feature name="I3_FEATURE_ICWS_SDK" /><Feature name="I3_FEATURE_WEB_SERVICES" /><Feature name="I3_FEATURE_ADVANCED_SECURITY" /><Feature name="I3_FEATURE_RWP_CITY" /><Feature name="I3_FEATURE_VERSION_CIC" /><Feature name="I3_FEATURE_TRACKER" /><Feature name="I3_FEATURE_SIP_PROXY_LOAD_BALANCING" /><Feature name="I3_FEATURE_VERSION_SIP_PROXY_R2" /></Features><Licenses><License name="I3_ACCESS_HISTORICAL_REPORT_SUPERVISOR_PLUGIN" assigned="5" pooled="0" value="5" /><License name="I3_ACCESS_ACD_MEDIA_1" assigned="5" pooled="0" value="5" /><License name="I3_ACCESS_ACD_MEDIA_2" assigned="5" pooled="0" value="5" /><License name="I3_ACCESS_REPORT_ASSISTANT_SUPERVISOR_PLUGIN" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_SIP_PROXY_G.729_SESSIONS" assigned="3" pooled="0" value="3" /><License name="I3_ACCESS_TRACKER" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_SIP_PROXY_MEDIA_PORTS" assigned="7" pooled="0" value="7" /><License name="I3_LICENSE_CONFERENCE_SESSION_ADDON" assigned="5" pooled="0" value="5" /><License name="I3_ACCESS_DATA_EXTRACTOR" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_EXTERNAL_CALL_PORTS" assigned="0" pooled="5" value="5" /><License name="I3_ACCESS_CLIENT" assigned="5" pooled="0" value="5" /><License name="I3_ACCESS_ACD_MEDIA_3_PLUS" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_MEDIA_SESSION_ADDON" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_SIP_PROXY_25_REGISTRATIONS" assigned="7" pooled="0" value="7" /><License name="I3_LICENSE_BASIC_STATION" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_ADVANCED_SESSION_ADDON" assigned="5" pooled="0" value="5" /><License name="I3_LICENSE_FAX_SESSION" assigned="0" pooled="5" value="5" /></Licenses><Servers><Server name="SAMPLE" identifier="SAMPLE" created="2018-04-12 17:01:01.000" expires="2018-04-12 17:00:00.000" hash="2sL9XVxRgzVOKy5Cnve1PG4utC2zeXCFJMEqnKDnpoH8e21JJCT9n1PtyP8+8EoU&#xA;uJKS4Rjyk670X25/xwChs5cn22NwHo5Vi315rnM0CmaXYdNJc/G9/VmcIdV8vsmX&#xA;H8UAklrI5FLrJ5MKYfkxew8WCbzOHIwnI48q4av4N+I=&#xA;" hash2="DhOsHbbZpXIXHEbZ9CSiqZCDOpKs2I+WRZIPPV3YoisiJcpcYkV24i8ibtc+bZ+l&#xA;00ATf6D/AgcesSDGMe4iZ8awct91l5aY0g4s5q0CBm2Ea/nHjmsXRzEaVhWzwwCK&#xA;aouK7fnF6oRD4EqgQCuQCZKFHe6CZdPu8vMOYQz39bo=&#xA;"><InvalidatedLicenses></InvalidatedLicenses></Server></Servers><AmazonS3Credentials userName="AKIAIMTO3HCQJ4TH4ULQ" userPassword="FYg/8w4oq4LeVF2108OMcOASCjQZdOwG55F3sP0uvFLHe2i1CIMPnQrXbeDu9WWs&#xA;JhKx+ezC/1bu8wnbPWEJ0rb4xD0ooTiIlRrH0Gj+bCuI26JIelr+vE7N1aC/+IDN&#xA;k4zbflfMNmhuQfMuVOMHF+Vl0uHe2X35JUma7kd3SBM=&#xA;" hash="jAISXnVBQNqjV2EfvC15vrTSGrNezxtDXItsMQ20imIGrK5tlf0YszHfh6w+5Hq8&#xA;G/Ksc5+GarUwRhSzu+y5Z21D5gcM0TnmUdEWPgAtYdUTbslCKA73ZQ1IdyLSEyXc&#xA;wQoWC2jFjP4QIhwMeOHEvBqnYUS9tOxieN2yml6LCas=&#xA;"></AmazonS3Credentials></LicenseFile></LicenseFiles>';
    
    static void setUpdata() {
    	
        Acc= new Account(Name='Test Account',SAP_Account_Code__c='Test 001');
        insert Acc;
        
        Con = new Contact(LastName='Test Contact',AccountId=Acc.id);
        insert Con;
        
        Opp = new opportunity(Name='Test Opp',AccountId=Acc.Id,StageName='1.Understand Needs',CloseDate=Date.newInstance(2020, 12, 9));
        insert Opp;
        
        ord2 = new Order__c(Opportunity__c=opp.id);
        insert ord2;
        
        quote= new BigMachines__Quote__c(Contact__c=con.id,BigMachines__Opportunity__c=opp.id,Order__c=ord2.id);
        insert quote;
        
        ord = new Order__c(Opportunity__c=opp.id,Quote__c=quote.id);
        insert ord;
        
        Cdeploy= new Cloud_Deployment__c(Order__c=ord.Id);
        insert Cdeploy;
        
        subscrb= new Subscription__c(Order__c=ord.id,Opportunity_LookUp__c=opp.Id,Quote__c=quote.id,Status__c='Active',
                                     cloud_deployment__c=Cdeploy.Id,Account__c=Acc.Id,Subscription_Start_Date__c=date.today());
        insert subscrb;
        subscrb2= new Subscription__c(Order__c=ord2.id,Opportunity_LookUp__c=opp.Id,Quote__c=quote.id,Status__c='Active',
                                     cloud_deployment__c=Cdeploy.Id,Account__c=Acc.Id,Subscription_Start_Date__c=date.today());
        insert subscrb2;
        
        PrdName= new LMS_ProductName__c(Name='CIC',Legacy_ID__c='500');
        insert PrdName;
        
        LMSProdLine= new LMS_ProductLine__c(Name='CIC 4.0',isActive__c=true,Product_Name__c=PrdName.id);
        insert LMSProdLine;
        
        license = new LMS_License_Types__c(Description__c='test',Name='Production',LicenseTypeGUID__c='1A988485-D61D-4D55-A81E-D793D8FBDED5',Expiry_Duration__c=1,ExpiryType__c='Years',Leagcy_Id__c=1,Ordered__c=true);
        insert license;
        system.assertEquals('Production', license.Name);
        
        SRL = new Subscription_Request_Log__c(Name='Req Log',Cloud_Deployment__c=Cdeploy.Id,Product_Line__c=LMSProdLine.id,
                                              License_Type__c=license.id,
                                              License_Text__c=LicenceText);
        insert SRL;
        
        SubscriptionKeyOverride__c SKO= new SubscriptionKeyOverride__c(Key__c='test 123',Assigned__c=1,Pooled__c=2);
        insert SKO;
    }
    
    static testMethod void Method1() {
        setUpdata();
        system.debug('quote Id test'+quote.Id);
		BigMachines__Quote__c  bigquote=[SELECT Id,order__c FROM BigMachines__Quote__c WHERE Id=:quote.Id];   
        Account a=[SELECT Id,Name,SAP_Account_Code__c FROM Account WHERE Id=:Acc.Id];
        Contact c=[SELECT Id,AccountId FROM contact WHERE Id=:con.Id];
        Subscription_Request_Log__c log=[SELECT ID,Cloud_Deployment__c,Product_Line__c,License_Text__c FROM Subscription_Request_Log__c WHERE Id=:SRL.id];
        //LMS_ProductLine__c Prodline=[SELECT Id,Product_Name__c FORM LMS_ProductLine__c WHERE Id=:LMSProdLine.id];
        PageReference pageRef = Page.SubscriptionManagement;
        Test.setCurrentPage(pageRef); 
        subscriptionManagementController lc = new subscriptionManagementController();
        lc.selectedTab='NewLicenseTab';

        lc.tabClicked();
         
        NewSubscriptionComponentController controller = new NewSubscriptionComponentController();
        controller.Orderopt = bigquote;
        controller.accountSelection = C;
        controller.selectedAccount= A;
        controller.show=true;
        controller.switchHostIds='Test switchHostIds';
        controller.switchmachineNames='Test switchmachineNames';
        controller.selectedLicense ='Production';
        controller.selectedProdLine='CIC 4.0';
        controller.selectedProductLine='CIC 4.0';
        controller.endUserAccountId=a.id;
        controller.createDeployment();
        controller.log=log;
        controller.pageTwoCompleted();
        controller.refresh();
        //controller.createLog(LicenceText);
        //controller.calloutLicenseService();
    }

}