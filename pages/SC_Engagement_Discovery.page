<apex:page controller="DSRDiscoveryController"  sidebar="false" docType="html-5.0">
 <apex:form >
  <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <head>
        <apex:stylesheet value="{!URLFOR($Resource.SLDS, 'assets/styles/salesforce-lightning-design-system-vf.css')}" />
    </head>
  </html>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/ecmascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
        <apex:includeScript value="{!$Resource.SharepointIntegration}"/>
        <script>
        </script>
        <script>
            var j$ = jQuery.noConflict();
             var sceid = '{!objSCE.Id}';
            j$(document).ready(function(){
               j$('.dateFormat').hide();
               j$(".clsBoxClose").click( function() {           
                    unloadPopupBox();
                });
                
                /*Set z-index for Date picker on POP up window*/
                j$('.datePicker').css('z-index', 99999);
                 j$('.clsActdate').on('focus', function (e) {
                    e.preventDefault();
                    j$(this).datepicker('show');
                    j$(this).datepicker('widget').css('z-index', 99999);
                }); 
                
                /*Open link in new tab*/
                j$('.openInPopup a').click(function(event) {
 
                    event.preventDefault();
                    window.open(j$(this).attr('href'));
                });
            });
            function loadPopupBox(fType) 
            {  
              // To Load the Popupbox
              //j$('[id$=hdnFileType]').val(fType);
              j$('#popup_box').fadeIn("slow");
              j$('.parentDisable').css('display','block');
              
              j$("#container").css({ // this is just for style
                 "opacity": "0.3" 
              }); 
              return false;       
            } 
            function unloadPopupBox() 
            {    
             // TO Unload the Popupbox
             j$('#popup_box').fadeOut("slow");
             j$('.parentDisable').css('display','none');
             j$("#container").css({ // this is just for style       
                "opacity": "1.80" 
             });
             return false;
            }
            
            function GetDesc()
            {
                var VisionType = j$('.clsVisionType').val();
                //Added by Ashish Goyal (09/20/2018) to resolve None selection issue
                if(VisionType == ''){
                    document.getElementById('urlLinkId').setAttribute('href', '#');
                    document.getElementById('urlLinkId').className = 'disabled';
                    j$('.attachDesc').val('');
                    j$('.attachNote').val('');
                    return;
                }
                
                j$('.clsSpinner').css('display','block');
                
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.DSRDiscoveryController.GetDescription}',
                    VisionType, 
                    function(result, event){
                        if (event.status) 
                        {
                            var des = result;
                            j$('.clsDesc').val(des.Description__c);
                            if(des.URLRequired__c)
                            {
                              j$('.clsAttachment').css('border-left','2px solid red');
                              j$('[id$=hdnUrlReq]').val('YES');
                            }
                            else
                            {
                              j$('[id$=hdnUrlReq]').val('NO');
                              j$('.clsAttachment').css('border-left','none');
                            }
                            var prefix = des.FullDescriptionURL__c;
                            if(prefix != null){
                                if(!prefix.includes('http://') && !prefix.includes('https://')){
                                    prefix = 'http://'+ des.FullDescriptionURL__c;
                                }
                                document.getElementById('urlLinkId').setAttribute('href', prefix);
                                document.getElementById('urlLinkId').className = '';
                            }else{
                                document.getElementById('urlLinkId').setAttribute('href', '#');
                                document.getElementById('urlLinkId').className = 'disabled';
                            }
                            j$('.attachDesc').val(des.Description__c);
                            j$('.attachNote').val(des.Notes__c);
                            j$('.clsSpinner').css('display','none');

                        } else if (event.type === 'exception') {
                            document.getElementById("responseErrors").innerHTML = 
                                event.message + "<br/>\n<pre>" + event.where + "</pre>";
                        } else {
                            document.getElementById("responseErrors").innerHTML = event.message;
                        }
                    }, 
                    {escape: true}
                );
            }
            
            function GetSource()
            {
                var objAccess = j$('.clsAccess').val();
                j$('.clsSpinner').css('display','block');
                afAccess(objAccess);
            }
            function HideProgressBar()
            {
              j$('.clsSpinner').css('display','none');
            }
            
            // Priyank added below function for Url validation. 
            function validUrlCheck(){
                var a = document.getElementsByClassName("clsAttachment")[0].value;
                if(a != ''){
                    //var regexp = new RegExp(/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/ );
                    //var regexp = /^(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/|ftp:\/\/www\.|ftps:\/\/www\.|ftp:\/\/|ftps:\/\/|smtp:\/\/www\.|smtps:\/\/www\.|smtp:\/\/|smtps:\/\/)?([w][w][w])+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/;
                    var regexp = /^((https|smtps|ftps|ftp|smtp)?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/;
                    if (regexp.test(a)) {
                        saveMethod();
                        return true;
                    }else{
                        var div = document.getElementById("errorMesg");
                        div.innerHTML = "URL is Not Valid. Please Enter Valid URL";
                        return false;
                    }
                }else{
                    saveMethod();
                }
            }
            
            //Below function was added by priyank 15 Nov 2018 to check the mandatory URL on click of edit button.
            function requiredCheck(isCheck){
                if(isCheck){
                    j$('.clsAttachment').css('border-left','2px solid red');
                    j$('[id$=hdnUrlReq]').val('YES');
                }else{
                    j$('.clsAttachment').css('border-left','');
                    j$('[id$=hdnUrlReq]').val('NO');
                }
            }
            //Priyank ended.
            
            function Confirmation()
            {
               var isRetrn = true;
               if(isRetrn == true && objType != null)
               {
                   var objConfirm = confirm("Do you want to delete the Vision Activity");
                   if(objConfirm == false)
                     isRetrn = false;
               }
               return isRetrn;
            }
            function MandatoryCheck()
            {
               var retrn = true;
               if(j$('.clsVisionType').val() == '')
               {
                 retrn = false;
                 alert('Please select activity type.');
               }
               if(j$('.clsDesc').val() == '')
               {
                 retrn = false;
                 alert('Please enter description.');
               }
               //if(j$('.clsVisionType').val() == '')
               //{
               //  retrn = false;
               //  alert('Please activity type.');
               //}
               if(j$('.clsActdate').val() == '')
               {
                 retrn = false;
                 alert('Please select activity date.');
               }
               if(j$('.clsAccess').val() == '')
               {
                 retrn = false;
                 alert('Please select access.');
               }
               if(j$('.clsSource').val() == '')
               {
                 retrn = false;
                 alert('Please select source.');
               }
               return retrn;
            }
    </script>
        
        <style>
            .slds .slds-button--brand {
                padding-left: 35px;
                padding-right: 35px;
            }
            .slds .slds-button {
                line-height: 50px;
                font-size: 150%;
            }
        </style>
        <style>       
           /* popup_box DIV-Styles  Start*/
            #popup_box {
                top: 4%;
                position:fixed; 
                display:block; /* Hide the DIV */
                border-color: #0070d2;
                border-width: 2px;            
                z-index: 999;
                left: 40%;
                padding:10px;
                border-radius: 4px;
                border-style: outset;
                margin-left: -250px;               
            }           
            
            a{ 
                cursor: pointer; 
                text-decoration:none; 
            }
            
            /* This is for the positioning of the Close Link */
            .parentDisable{
                position:fixed;
                top:0;
                left:0;
                background:#000;
                opacity:0.20;
                z-index:998;
                height:100%;
                width:100%;}

            #popupBoxClose {
                font-size:20px;  
                line-height:15px;  
                right:5px;  
                top:5px;  
                position:absolute;  
                color:#6fa5e2;  
                font-weight:500;      
            }
            .clsUser select{
                visibility: hidden !important;
                display: block !important;
                }
                div.tooltip {
                width: 20px;
                float: right;
                display:inline;
            }
            .clsSolutionCon select{
                visibility: hidden !important;
                display: block !important;
                }
                div.tooltip {
                width: 20px;
                float: right;
                display:inline;
            }
            
            div.tooltip span {
                display: none;
                font-weight:normal;
                text-align:left;
                padding: 3px 5px;
                margin-left: 8px;
                width: 250px;
            }
            
            div.tooltip:hover span {
                display: inline;
                position: absolute;
                border: 1px solid #cccccc;
                background: #FFC;
                color: #000000;
                z-index:10000;
            }
            .Mylinks
            {
                color:#000000;            
            }
            a:visited
            {
                color:Blue;           
            }
            .pbTitle {
            white-space: nowrap;
            }
            
            .slds .slds-table th, .slds .slds-table td {
               
                white-space: normal;
            }
        
       </style>
       
       <style>
         <!-- progress bar -->
         .clsSpinner{
                /* Background color */
                
                filter: alpha(opacity = 20);
            
                /* Dimensions */
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: 1002;
                position: absolute;
                
                /* Mouse */
                cursor:wait;
            }
         
            /* This is for the message DIV */
            .PopupPanel {
                /* Background color */
                border: solid 2px blue;
                background-color: white;
         
                /* Dimensions */
                left: 50%;
                width: 150px;
                margin-left: -100px;
                top: 50%;
                height: 20px;
                margin-top: -25px;
                z-index: 1001;
                position: fixed;
                
                /* Mouse */
                cursor:pointer;
            }
            .messageTable{
                width: 100%;
                margin-bottom: 10px;
            }
            .message .messageText h4 { 
                display: none;
            } 
            .errorM3 .msgIcon, .errorMedium {
                background-image:
                background-position: 0 0;
                width: 0;
                height: 0;
            }
            .message .messageText {
                color: red;
                text-align: center;
                font-size: 12px;
                font-weight: 600;
            }
            .spinnerBg{
                width: 100%;
                height: 100%;
                position: absolute;
                background-color: #000;
                opacity: 0.2;
                z-index: 999999;
            }
            .spinner{
                width: 100%;
                height: 100%;
                position: absolute;
                background-image: url("/img/loading32.gif");
                background-size: 16px;
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-position: center;
                z-index: 9999999;
                opacity: 1;
            }
            
            .slds hr {
                display: block;
                margin: 32px 0;
                border-top: 2px solid #006fd2;
                height: 1px;
                clear: both;
            }
             .RequirInpt{
               position: relative;
              height: 100%;
             }
             .Requir{
                   background-color: #c00;
                    position: absolute;
                    left: -4px;
                    width: 3px;
                    top: 1px;
                    bottom: 1px;
             }
             a.disabled {
               pointer-events: none;
               cursor: default;
            }
       </style>
       
    <Script>
  function setFocusOnLoad() {}
</Script>
    <body>
    <!-- Priyank added below action function -->
    <apex:actionFunction name="saveMethod" action="{!saveVisionActivity}" rerender="pnlAllActivity,pnlPopUp_parent" status="spinnerStatus" />
    <apex:actionStatus id="spinnerStatus">
        <apex:facet name="start">
            <div class="spinnerBg" />
            <div class="spinner" ></div>
        </apex:facet>
    </apex:actionStatus>
    <apex:inputHidden value="{!strURLReq}" id="hdnUrlReq"/>
     <apex:pagemessages rendered="{!blnShowErrorMsg}" />
    <apex:actionFunction action="{!GetAccessAndSource}" oncomplete="HideProgressBar()" immediate="false"  name="afAccess" reRender="idSource">
      <apex:param name="firstParam" assignTo="{!strSelectedAccess}" value="" />
    </apex:actionFunction>
    <div id="spinner" style="display: none" class="clsSpinner">
      <div class="PopupPanel">
        <apex:image id="theProgress" value="{!$Resource.ProgressBarStatus}" width="20" height="20"/>
      </div>
    </div>
    
    <apex:inputHidden value="{!FileDescType}" id="hdnFileType" />
      <div class="slds"> 
          <div class="slds-page-header" role="banner"> 
                    <div class="slds-grid">
                        <div class="slds-col">  
                            <div class="slds-media"> 
                                <div class="slds-media__figure">
                                </div>
                                
                               
                                <div class="slds-media__body">
                                    <table>
                                       <tr>
                                         <td><h1 class="slds-text-heading--small"><a  href="{!IF((objSCE.Is_partner_DSR__C  && ipartneruser), '/partner','/apex')}/SC_Engagement_Vision?id={!objSCE.id}" target="_self"><apex:image id="theImage" value="{!$Resource.aerrow_left}" width="20" height="20" /></a></h1></td>
                                         <td><h1 class="slds-text-heading--small"><b>Discovery</b></h1></td>
                                         <!--<td><h1 class="slds-text-heading--small" style="padding-top:19px;"><b>Opportunity Platform Type :</b></h1>&nbsp;{!objOpp.Primary_Line_of_Business__c}</td>
                                         <td><h1 class="slds-text-heading--small" style="padding-top:19px;"><b>Opportunity Offer Type :</b></h1>&nbsp;{!objOpp.Lines_of_Businesses__c}</td>-->
                                         <apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">
                                         <td style="text-align: -webkit-right;"><h1 class="slds-text-heading--small"><a href="{!map_DiscoveryLinks['Discovery How To']}" target="_blank">Discovery How To</a></h1></td>
                                         <td style="text-align: -webkit-right;"><h1 class="slds-text-heading--small"><a  href="{!map_DiscoveryLinks['Discovery Assets']}" target="_blank">Discovery Assets</a></h1></td>
                                         </apex:outputpanel>
                                         <td style="text-align: -webkit-right;"><h1 class="slds-text-heading--small"><b><a  href='{!HomeURL}' target="_self">Home</a></b></h1></td>
                                         <td style="text-align: -webkit-right;"><h1 class="slds-text-heading--small">   <a  href="{!IF((objSCE.Is_partner_DSR__C && ipartneruser), '/partner','/apex')}/SC_Engagement_Design?id={!objSCE.id}" target="_self"><apex:image id="theImage2" value="{!$Resource.aerrow_right}" width="20" height="20"/></a></h1></td>
                                         
                                       </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
          <div class="myapp">
            <div class="slds-grid slds-m-top--large">
              <div style="width:100%; margin-left:0%;">
                <div class="slds-card" style="text-align:-webkit-center;">
                     <div class="slds-card__body" style="width: 95%;;">
                      <apex:outputPanel styleClass="openInPopup">
                        <table>
                            <tr class="slds-hint-parent"  style="width: auto;height: 50px;">
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>SC DSR Name :</b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;"> <apex:outputField value="{!objSCE.Name}"/></td>
                                <!--<td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Has Vision Activities? : </b></td>
                                <td style="width:1%"></td>
                                <td class="" data-label="Monthlyrent" style="width:10%;text-align:left;"><apex:inputCheckbox value="{!blnHasVisionActivity}"/></td>-->
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Opportunity : </b></td>
                                <td style="width:1%"></td>
                                <td class="" data-label="Monthlyrent" style="width:10%;text-align:left;"><apex:outputField value="{!objSCE.Opportunity_ID__c}"/></td>
                                
                                <apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Status : </b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;">
                                  {!objSCE.SC_Engagement_Status__c}
                                </td>
                                </apex:outputpanel>
                                <apex:outputpanel rendered="{!objSCE.Is_Partner_DSR__c}">
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Start Date : </b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;">
                                 <apex:inputField value="{!objSCE.Discovery_Start_Date__c}" id="idVStartDtPart" rendered="{!NOT(blnIsSubmitted)}" style="width:60%" styleClass="slds-input"/>
                                 <apex:outputField value="{!objSCE.Discovery_Start_Date__c}" rendered="{!blnIsSubmitted}"/>
                                </td>
                                </apex:outputpanel>
                                
                            </tr>
                            <tr class="slds-hint-parent"  style="width: auto;height: 50px;">
                                <!--<td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Opportunity Offering Type :</b></td>
                                <td style="width:1%"></td>
                                <td class="" data-label="Monthlyrent" style="width:10%;text-align:left;"><apex:outputField value="{!objOpp.Lines_of_Businesses__c}"/></td>-->
                                
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Opportunity Lead Offer :</b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;"><apex:outputField value="{!objOpp.Lead_Offer__c}"/></td>
                                
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Account : </b></td>
                                <td style="width:1%"></td>
                                <td class="" data-label="Monthlyrent" style="width:10%;text-align:left;"><apex:outputField value="{!objSCE.Opportunity_ID__r.AccountId}"/></td>
                                
                                <apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Start Date : </b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;">
                                 <apex:inputField value="{!objSCE.Discovery_Start_Date__c}" id="idVStartDt" rendered="{!NOT(blnIsSubmitted)}" style="width:60%" styleClass="slds-input"/>
                                 <apex:outputField value="{!objSCE.Discovery_Start_Date__c}" rendered="{!blnIsSubmitted}"/>
                                </td>
                                </apex:outputpanel>
                                <apex:outputpanel rendered="{!objSCE.Is_Partner_DSR__c}">
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>End Date : </b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;">
                                  <apex:inputField value="{!objSCE.Discovery_End_Date__c}" id="idVEndDtPart" rendered="{!NOT(blnIsSubmitted)}" style="width:60%" styleClass="slds-input"/>
                                  <apex:outputField value="{!objSCE.Discovery_End_Date__c}" rendered="{!blnIsSubmitted}"/>
                                </td>
                                </apex:outputpanel>
                                
                            </tr>
                                
                            <tr class="slds-hint-parent"  style="width: auto;height: 25px;">
                                <!--<td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Opportunity Platform Type :</b></td>
                                <td style="width:1%"></td>
                                <td class="" data-label="Monthlyrent" style="width:10%;text-align:left;"><apex:outputField value="{!objOpp.Primary_Line_of_Business__c}"/></td>-->
                                
                                <!-- Added by Debora Lane 14-May-18 -->
                                  <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>Opportunity Current Stage : </b></td>
                                  <td style="width:1%"></td>
                                  <td class="" data-label="Monthlyrent" style="width:10%;text-align:left;"><apex:outputField value="{!objOpp.Stagename}"/></td>
                                
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;"></td> 
                                
                                <apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">
                                <td class="" data-label="RoomNumber" style="width:10%;text-align:right;"><b>End Date : </b></td>
                                <td style="width:1%"></td>
                                <td style="width:10%;text-align:left;">
                                  <apex:inputField value="{!objSCE.Discovery_End_Date__c}" id="idVEndDt" rendered="{!NOT(blnIsSubmitted)}" style="width:60%" styleClass="slds-input"/>
                                  <apex:outputField value="{!objSCE.Discovery_End_Date__c}" rendered="{!blnIsSubmitted}"/>
                                </td>
                                </apex:outputpanel>
                            </tr>
                            
                        </table>
                        <br/>
                        <br/>
                        <br/>
                       </apex:outputPanel>  
                        <table>
                          <tr>
                            <td><b>Discovery-General Notes</b></td>
                          </tr>
                          <tr>
                            <td>
                               <apex:inputTextarea value="{!objSCE.Discovery_Notes__c}" style="width:100%;height:101px;border-radius: 8px;border: 2px solid #5786e0;" rendered="{!NOT(blnIsSubmitted)}" styleClass=""/>
                               <apex:outputField value="{!objSCE.Discovery_Notes__c}" style="width:100%;height:101px;" rendered="{!blnIsSubmitted}"/>
                            </td>
                          </tr>
                        </table>
                        <table>
                          <tr>
                            <td  style="text-align: -webkit-center;">
                            <div class="slds-button-group" role="group">
                              <apex:commandButton value="Save" rendered="{!NOT(blnIsSubmitted)}" style="font-weight: bolder;line-height:10px;font-size:15px;" styleClass="slds-button slds-button--brand slds-button--small" action="{!SaveSCE}"/>
                            </div>
                            </td>
                          </tr>
                        </table>
                        <hr/>
                        <table>
                          <tr style="height: 45px;">
                            <td style="width:60%:">
                                <table style="width:100%;" >
                                    <tr>
                                        <td style="width:14%">
                                            <b>Discovery Activities</b>
                                        </td>
                                        <td style="text-align: -webkit-left;">
                                            <apex:commandButton rendered="{!NOT(blnIsSubmitted)}" action="{!AddAct}"  value="Add Activity" style="font-weight: bolder;line-height:26px;font-size:96%" styleClass="slds-button slds-button--brand slds-button--small"  rerender="pnlPopUp_parent" status="spinnerStatus"/>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                          </tr> 
                          <tr>
                            <td> 
                            <apex:outputPanel id="pnlAllActivity">      
                              <table class="slds-table slds-table--bordered" style="width:100%;border: 2px solid #0070d2;" >
                                <thead>
                                    <tr style="background-color:#0070d2">
                                        <th style="">
                                            <b style="color: white;">Activity Type</b>
                                        </th>
                                        <th  style="">
                                            <b style="color: white;">Description</b>
                                        </th>
                                        <th  style="">
                                            <b style="color: white;">Attachment URL</b>
                                        </th>
                                        <th  style="">
                                           <b style="color: white;">Date of Activity</b>
                                        </th>
                                        <!--<apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">-->
                                        <th  style="display:{!if(objSCE.Is_Partner_DSR__c,'none','')}">
                                            <b style="color: white;">Access</b>
                                        </th>
                                        <!--</apex:outputpanel>-->
                                        <th  style="">
                                            <b style="color: white;">Source</b>
                                        </th>
                                        <th  style="">
                                            <b style="color: white;">Notes</b>
                                        </th>
                                        <th  style="{!IF((NOT(blnIsSubmitted)),'','display:none;')}">
                                            <b style="color: white;">Action</b>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody style="width:100%;table-layout: fixed;">
                                  <apex:repeat value="{!list_VisionActivity}" var="vi">
                                    <tr class="slds-hint-parent"  style="width: auto;">
                                        <td style="max-width:30px;word-wrap: break-word;">{!vi.AttachmentType__c}</td>
                                        <td style="max-width:116px;word-wrap: break-word;text-align: justify;">{!vi.Description__c}</td>
                                        
                                        <!--td style="max-width:30px;word-wrap: break-word;"><apex:outputField value="{!vi.AttachmentURL__c}"/></td>-->
                                        
                                        <td style="max-width:30px;word-wrap: break-word;"><apex:outputLink value="{!IF(BEGINS(LOWER(vi.AttachmentURL__c), 'http'), vi.AttachmentURL__c, 'https://'+vi.AttachmentURL__c)}" target="_blank">{!vi.AttachmentURL__c}</apex:outputLink></td>
                                        <td style="max-width:30px;word-wrap: break-word;">
                                          <apex:outputText value="{0,date,MM/dd/yy}"> <apex:param value="{!vi.DateofAttachment__c}" /> </apex:outputText>
                                        </td>
                                        <!--<apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">-->
                                        <!--<td style="max-width:30px;word-wrap: break-word;">{!vi.Access__c}</td>-->
                                        <!--</apex:outputpanel>-->
                                        <td style="max-width:30px;word-wrap: break-word;display:{!if(objSCE.Is_Partner_DSR__c,'none','')}">{!vi.Access__c}</td>
                                        
                                        <td style="max-width:30px;word-wrap: break-word;">{!vi.Source__c}</td>
                                        <td style="max-width:180px;word-wrap: break-word;text-align: justify;">{!vi.Notes__c}</td>
                                        <td style="{!IF((NOT(blnIsSubmitted)),'max-width:100px;word-wrap: break-word','display:none;')}">
                                            <!--priyank added oncomplete in below tag to check url is mandatory or not. 15 Nov 2018 -->
                                          <apex:commandLink rendered="{!NOT(blnIsSubmitted)}" value="Edit" rerender="pnlPopUp_parent"  action="{!EditActivity}" oncomplete="requiredCheck({!checkMandatory})" status="spinnerStatus">
                                            <apex:param name="vi" assignTo="{!strVisionActId}" value="{!vi.id}"/>
                                          </apex:commandLink> 
                                          &nbsp;|&nbsp;
                                          <apex:commandLink rendered="{!NOT(blnIsSubmitted)}" value="Remove"  action="{!RemoveVisionActivity}" status="spinnerStatus">
                                            <apex:param name="vi" assignTo="{!strVisionActId}" value="{!vi.id}"/>
                                          </apex:commandLink> 
                                        </td>
                                    </tr>
                                  </apex:repeat>   
                                </tbody>
                              </table>
                             </apex:outputPanel>   
                             </td>
                           </tr>            
                        </table>
                     </div>
                </div>   
                 <apex:outputPanel id="pnlPopUp_parent"> 
                                  
                     <apex:outputPanel styleClass="parentDisable" layout="block" rendered="{!blnParentDisable}"/>
                    
                     <apex:outputPanel id="pnlPopup" styleClass="clsPnlPopUp" layout="block" rendered="{!blnParentDisable}" style="overflow-y: auto;">
                       <div id="popup_box" class="slds-card clsPop" style="height:96%; overflow-y: auto;position: fixed;">
                           <apex:outputPanel id="pnlerrorMsg" rendered="{!blnShowErrorMsg_Popup}">
                               <apex:pagemessages rendered="{!blnShowErrorMsg_Popup}" />
                           </apex:outputPanel>
                           <div style="float:left;width:10px;color:black;"></div>
                             
                            <div  class="slds-tile" > 
                             <div  class="slds-tile__detail">
                               <div class="clsMsg" style="color:red"></div>
                               <apex:actionFunction name="afPopUp" action="{!saveVisionActivity}" reRender="idMsgPopUp,rptActvities"/>
                                <table>
                                    <tr>
                                        <td style="text-align:left;color:#3B76DD;font-size:larger"><b>Attachment Type</b></td>
                                        <td style="text-align:right;color:#3B76DD;font-size:larger"><b>Discovery</b></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">&nbsp;</td>
                                    </tr>
                                    <tr class="slds-item_label slds-text-color_weak slds-truncate"  style="width: 90%;height: 50px;margin-top:5%">
                                        <td colspan="2" style="padding-left: 20px;">
                                            <div class="">
                                                <div class=""></div>
                                                <apex:selectList value="{!strSelectedVisionType}" onchange="GetDesc()"  size="1" id="VisionType" style="width:100%;border-left: 2px solid red;" styleClass="clsVisionType slds-input">
                                                    <apex:selectOptions value="{!optionList}"/>
                                                </apex:selectList>
                                            </div>
                                        </td>
                                   </tr>
                                </table>
                                <br/>
                                <apex:outputPanel id="discoveryLoad">
                                    <table>
                                        <tr>
                                            <td style="text-align:left; color:#3B76DD;font-size:larger"><b>Attachment Type Info</b></td>
                                            <td style="text-align:right;"><a class="{!if(dataDef.FullDescriptionURL__c != null, '','disabled')}" id="urlLinkId" href="{!if(dataDef.FullDescriptionURL__c != null, dataDef.FullDescriptionURL__c,'#')}" target="_blank" style="text-decoration: underline;">Documentation on Attachment Type</a></td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">&nbsp;</td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <table style="outline: 2px solid blue;" cellpadding="4">
                                                    <tr>
                                                        <td colspan="4">&nbsp;</td>
                                                    </tr>
                                                    <tr style="width: 90%;height: 20px;margin-top:5%">
                                                        <td style="padding-left: 20px;vertical-align: top; color:#808080">Attachment<br/>Type<br/>Description</td>
                                                        <td style="width:4px;">&nbsp;</td>
                                                        <td>
                                                            <div class="">
                                                                <div class=""></div>
                                                                <apex:inputTextArea styleClass="attachDesc" readonly="true" rows="3" cols="80" value="{!dataDef.Description__c}" />
                                                            </div>&nbsp;&nbsp;
                                                        </td>
                                                        <td style="width: 10px;">&nbsp;</td>
                                                   </tr>
                                                   <tr style="width: 90%;height: 20px;margin-top:5%">
                                                        <td style="padding-left: 20px;vertical-align: top; color:#808080">Notes on<br/>Attachment<br/>Type</td>
                                                        <td style="width:4px;">&nbsp;</td>
                                                        <td>
                                                            <div class="">
                                                                <div class=""></div>
                                                                <apex:inputTextArea styleClass="attachNote"  readonly="true" rows="3" cols="80" value="{!dataDef.Notes__c}" />
                                                            </div>&nbsp;&nbsp;
                                                        </td>
                                                        <td style="width: 10px;">&nbsp;</td>
                                                   </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table><br/>
                                    <table>
                                        <table>
                                            <tr>
                                                <td style="text-align:left;color:#3B76DD; font-size:larger"><b>Attachment Details for this DSR</b></td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <table style="width:100%; outline: 2px solid blue;" cellpadding="4">
                                                        <tr>
                                                            <td colspan="6" style="padding-bottom: 7px; padding-top: 2px; padding-left: 5px; color:#808080">Enter information about the activity or attachment below:</td>
                                                        </tr>
                                                        <tr style="width: 90%;">
                                                            <td style="padding-left: 20px;vertical-align: top;">Description</td>
                                                            <td style="width:4px;">&nbsp;</td>
                                                            <td colspan="3">
                                                                <div class="">
                                                                    <div class=""></div>
                                                                    <apex:inputTextArea rows="3" cols="80" value="{!objDSRActivity.Description__c}" id="idDesc"/>
                                                                </div>&nbsp;&nbsp;
                                                            </td>
                                                            <td>&nbsp;</td>
                                                       </tr>
                                                       <tr style="width: 90%;">
                                                            <td style="padding-left: 20px;vertical-align: top;">Attachment<br/> URL</td>
                                                            <td style="width:4px;">&nbsp;</td>
                                                            <td colspan="3">
                                                               <div class="">
                                                                  <apex:outputPanel id="atturl">
                                                                      <apex:inputField value="{!objDSRActivity.AttachmentURL__c}" style="{!IF((strURLReq == 'YES'),'border-left: 2px solid red;wwidth:100%;height:39px;line-height: normal;','width:100%;height:39px;line-height: normal;')}" styleClass="clsAttachment slds-input"/><br/>
                                                                  </apex:outputpanel>
                                                                  <!-- Priyank added below Div -->
                                                                  <div id="errorMesg" style="width:100%;color:red;"></div>
                                                                </div>
                                                                <input type="file" id="attachmentFile" /> 
                                                                <apex:outputpanel rendered="{!!objSCE.Is_Partner_DSR__c}">
                                                                    <button onclick="return uploadFile('Vision','{!objSCE.Name}','clsAttachment');" Class="slds-button slds-button--brand slds-button--small" style="line-height:10px;font-size:15px;padding-left: 10px;padding-right: 10px;">Upload File</button>
                                                                </apex:outputpanel>
                                                                <apex:outputpanel rendered="{!objSCE.Is_Partner_DSR__c}">
                                                                    <button onclick="return uploadFileAttached();" Class="slds-button slds-button--brand slds-button--small" style="line-height:10px;font-size:15px;padding-left: 10px;padding-right: 10px;">Upload File</button>
                                                                </apex:outputpanel>
                                                            </td>
                                                            <td>&nbsp;</td>
                                                       </tr>
                                                       <tr  style="width: 90%;">
                                                            <td style="padding-left: 20px;vertical-align: top;">Date of<br/> Activity:</td>
                                                            <td style="width:4px;">&nbsp;</td>
                                                            <td colspan="2">
                                                                <div class="">
                                                                    <div class=""></div>
                                                                    <apex:inputField value="{!objDSRActivity.DateofAttachment__c}" style="border-left: 2px solid red;" styleClass="clsActdate slds-input"/>
                                                                </div>&nbsp;&nbsp;
                                                            </td>
                                                            <td colspan="2">&nbsp;</td>
                                                       </tr>
                                                       <tr  style="width: 90%;">
                                                            <td style="padding-left: 20px;vertical-align: top;">Source</td>
                                                            <td style="width:4px;">&nbsp;</td>
                                                            <td>
                                                              <div class="">
                                                                <div class=""></div>
                                                                <apex:selectList value="{!strSelectedSource}" size="1" id="idSource"  style="border-left: 2px solid red;" styleClass="clsSource slds-input">
                                                                  <apex:selectOptions value="{!optionListSource }"/>
                                                                </apex:selectList>
                                                               </div>&nbsp;&nbsp;
                                                            </td>
                                                            <apex:outputpanel layout="{!if(objSCE.Is_Partner_DSR__c,'','none')}"> 
                                                                 <td style="padding-left: 20px; text-align:center; vertical-align: top;">Access</td>
                                                                 <td style="vertical-align: top;">
                                                                     <div class="">
                                                                         <div class=""></div>
                                                                         <apex:selectList value="{!strSelectedAccess}"  style="width:100%;border-left: 2px solid red;vertical-align: top;"  size="1" id="idAccess" styleClass="clsAccess slds-input">
                                                                             <apex:selectOptions value="{!optionListAccess}"/>
                                                                         </apex:selectList>
                                                                    </div> 
                                                                 </td>
                                                            </apex:outputpanel>
                                                            <apex:outputpanel layout="{!if(!objSCE.Is_Partner_DSR__c,'','none')}"> 
                                                                <td colspan="2">&nbsp;</td>
                                                            </apex:outputpanel>
                                                            <td>&nbsp;</td>
                                                       </tr>
                                                       <tr  style="width: 90%;">
                                                            <td style="padding-left: 20px;vertical-align: top;">Notes</td>
                                                            <td style="width:4px;">&nbsp;</td>
                                                            <td colspan="3"><apex:inputTextArea rows="3" cols="80" value="{!objDSRActivity.Notes__c}" /></td>
                                                            <td>&nbsp;</td>
                                                       </tr>
                                                       
                                                    </table>
                                                </td>
                                            </tr>
                                        </table><br/>   
                                    </table>  
                                </apex:outputPanel>
                                
                                
                                 <br/>
                                 <div style="text-align: -webkit-center;">
                                                                              <!--<apex:commandButton value="Save" onclick="return MandatoryCheck();" action="{!saveVisionActivity}" reRender="errorMsg" style="line-height:10px;font-size:15px;" styleClass="slds-button slds-button--brand slds-button--small" />-->
                                     <!--<apex:commandButton value="Save"  action="{!saveVisionActivity}" reRender="pnlerrorMsg,pnlPopup,pnlPopUp_parent,pnlAllActivity,idVStartDt,idVEndDt,idVStartDtPart,idVEndDtPart" style="line-height:10px;font-size:15px;" styleClass="slds-button slds-button--brand slds-button--small"  status="spinnerStatus"/>&nbsp;-->
                                     <!-- Priyank commented the above line and added new line below. -->
                                     <apex:commandButton value="Save"  onclick="validUrlCheck();return false;" reRender="pnlerrorMsg,pnlPopup,pnlPopUp_parent,pnlAllActivity,idVStartDt,idVEndDt,idVStartDtPart,idVEndDtPart" style="line-height:10px;font-size:15px;" styleClass="slds-button slds-button--brand slds-button--small"  status="spinnerStatus"/>&nbsp;
                                     <apex:commandButton value="Cancel" action="{!Cancel}" reRender="pnlerrorMsg,pnlPopup,pnlPopUp_parent,pnlAllActivity"  style="line-height:10px;font-size:15px;" styleClass="slds-button slds-button--brand slds-button--small clsBoxClose" id="popupBoxClose"  status="spinnerStatus" />
                                 </div>
                             </div> 
                           </div>  
                         
                         <!--</apex:pageBlock>-->
                       </div><!-- Close PopupBox DIV-->
                      </apex:outputPanel> 
                     </apex:outputPanel>
              </div>     
            </div>       
          </div>
      </div>
      <script type="text/javascript">
                var maxStringSize = 6000000;    //Maximum String size is 6,000,000 characters
                var maxFileSize = 4350000;      //After Base64 Encoding, this is the max file size
                var chunkSize = 950000;         //Maximum Javascript Remoting message size is 1,000,000 characters
                var attachment;
                var attachmentName;
                var fileSize;
                var positionIndex;
                var doneUploading;
               
            //Method to prepare a file to be attached to the Account bound to the page by the standardController
                function uploadFileAttachd() {
                debugger;
                //alert('{!objSCE.Is_Partner_DSR__c}');
                 
                  var file = document.getElementById('attachmentFile').files[0];
                  console.log(file);
                  if(file != undefined) {
                     
                      attachmentName = file.name;
                      var fileReader = new FileReader();
                      fileReader.onloadend = function(e) {
                        attachment = window.btoa(this.result);  //Base 64 encode the file before sending it
                        positionIndex=0;
                        fileSize = attachment.length;
                        console.log("Total Attachment Length: " + fileSize);
                        doneUploading = false;
                        uploadAttachments();
                      }
                      fileReader.onerror = function(e) {
                        alert("There was an error reading the file.  Please try again.");
                      }
                      fileReader.onabort = function(e) {
                        alert("There was an error reading the file.  Please try again.");
                      }
                     
                      fileReader.readAsBinaryString(file);  //Read the body of the file
                     
                  } else {
                    alert("You must choose a file before trying to upload it");
                  }
                  //j$('.clsSpinner').css('display','none');
                  return false;
                }
                 
            //Method to send a file to be attached to the Account bound to the page by the standardController
            //Sends parameters: Account Id, Attachment (body), Attachment Name, and the Id of the Attachment if it exists to the controller   
                function uploadAttachments() {
                   debugger;
                   j$('.clsSpinner').css('display','block');
                  Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.DSRDiscoveryController.FileURLinsert}',attachment, attachmentName, sceid,
                    function(result, event) {
                        debugger;
                      console.log(result);
                      j$('.clsAttachment.slds-input').val(result);
                      j$('.clsSpinner').css('display','none');
                    },
                    {escape: false, timeout: 120000}
                  );
                }
              </script>
      
    </body>    
 </apex:form> 
</apex:page>