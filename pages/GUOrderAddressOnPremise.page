<apex:page controller="GUOrderAddressOnPremiseController">
    <apex:form id="frmId">
        <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-1.4.2.min.js')}"/>
        <script type="text/javascript">
        function enableDisable(cb) {            
            $('input.example').on('change', function() {
                $('input.example').not(this).prop('checked', false);  
            });  
        }
          function replaceAddress(cnt) {
              //alert(cnt);
               var isConfirm= confirm('The address you have entered is going to be replaced with the selected address');
              if(isConfirm){
                  //alert('yes');
                  invokeRelaceAdd(cnt);
              }
              else{
                  //alert('No');
              }
         }  
        </script>
        <apex:actionFunction name="invokeRelaceAdd" action="{!reflectSelAddress}" rerender="terminator" status="status">
           <apex:param name="index" value="{!index}"/>
        </apex:actionFunction>
        <!--<apex:pageMessages id="pgmsgs"/>-->     
        <apex:actionFunction name="editAddress" action="{!editAddress}" reRender="popPanel2, msgs"  status="status">
            <apex:param name="addressId" value="" assignTo="{!addressId}" />
        </apex:actionFunction>
        <apex:actionFunction name="deleteAddress" action="{!deleteAddress}" reRender="pgblkAddress, msgs"  status="status">
            <apex:param name="addressId" value="" assignTo="{!addressId}" />
        </apex:actionFunction>      
        <apex:actionFunction name="makeAddressTypeEditable" action="{!makeAddressTypeEditable}" reRender="pgblkAccountAddress, msgs"  status="status" />
        <apex:actionFunction name="hideCreateNewPopup" action="{!hideCreateNewPopup}" reRender="popPanel,popPanel2, msgs"  status="status" immediate="true"/>
        <div style="color:blue;font-size:9pt;">
            <apex:outputpanel rendered="{!quote.Offering_Type__c != 'PureConnect Cloud'}">
                <b>Choose from the available addresses below or create a new address . Please note that Bill to, Ship to, End User , Sold to and Order Acknowledgement addresses are mandatory to Submit Order.</b><br/><br/>
            </apex:outputpanel>
            <apex:outputpanel rendered="{!quote.Offering_Type__c == 'PureConnect Cloud'}">
                <b>Choose from the available addresses below or create a new address . Please note that Bill to, End User and Sold to addresses are mandatory to Submit Order.</b><br/><br/>
            </apex:outputpanel>
        </div>        
        <apex:pageBlock title="Order Addresses" id="pgblkAddress">
            <apex:pageBlockButtons location="top">
              <!-- <apex:commandButton value="Create New Address" action="{!showCreateNewPopup}" reRender="popPanel, msgs" status="status"/>-->                 
                <apex:commandButton value="Save" action="{!save}" status="status" reRender="msgs" rendered="{!showOrderAddress}"/>
            </apex:pageBlockButtons>
            <apex:outputLabel value="No records to display" rendered="{!NOT(showOrderAddress)}" />
            <apex:pageBlockTable value="{!orderAddressOnOrder}" var="eachAddress" rendered="{!showOrderAddress}" >
                <apex:column headerValue="Action">
                    &nbsp; <a href="#" onclick="editAddress('{!eachAddress.id}'); return false;">Edit</a> &nbsp; | &nbsp;<a href="#" onclick="var result = confirm('Are you sure?');if(result == true){deleteAddress('{!eachAddress.id}'); return false;}" style="color:red">Del</a> 
                </apex:column>
                <apex:column headerValue="Address Type">
                    {!eachAddress.Address_Type__c}
                </apex:column>
                <apex:column headerValue="Address Line1">
                    {!eachAddress.Address_Line_1__c}
                </apex:column>
                <apex:column headerValue="Address Line2">
                    {!eachAddress.Address2__c}
                </apex:column>
                <apex:column headerValue="City">
                    {!eachAddress.City__c}
                </apex:column>
                <apex:column headerValue="State">
                    {!eachAddress.State__c}
                </apex:column>
                <apex:column headerValue="Country">
                    {!eachAddress.Country__c}
                </apex:column>
                <apex:column headerValue="Zip">
                    {!eachAddress.Zip_Code__c}
                </apex:column>              
                <apex:column headerValue="Phone">
                    <apex:inputField value="{!eachAddress.Phone__c}" />
                </apex:column>              
                <apex:column headerValue="Fax">
                    <apex:inputField value="{!eachAddress.Fax__c}" />
                </apex:column>              
                <apex:column headerValue="Email">
                    <apex:inputField value="{!eachAddress.Email__c}" rendered="{!eachAddress.Address_Type__c!='Ship To' && eachAddress.Address_Type__c!='Order Acknowledgement'}" />
                    <apex:outputPanel styleClass="requiredInput" layout="block" rendered="{!eachAddress.Address_Type__c='Ship To' || eachAddress.Address_Type__c='Order Acknowledgement'}">
                        <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                        <apex:inputText value="{!eachAddress.Email__c}" />
                    </apex:outputPanel>
                </apex:column>              
                
            </apex:pageBlockTable>  
        </apex:pageBlock>
        <apex:pageBlock title="Available Addresses" id="pgblkAccountAddress">
            <apex:pageBlockButtons location="top">  
               <apex:commandButton value="Create New Address" action="{!showCreateNewPopup}" reRender="popPanel, panelErrors" status="status"/>                
                <apex:commandButton value="Add Selected" action="{!addSelected}" reRender="GURefresh,pgblkAddress, pgblkAccountAddress, msgs" status="status"/>              
            </apex:pageBlockButtons>
            <apex:outputLabel value="No records to display" rendered="{!NOT(showAccountAddress)}" />
            <apex:pageBlockTable value="{!accountAddresses}" var="eachAddress" rendered="{!showAccountAddress}" >
                <apex:column >
                    <apex:inputCheckbox value="{!eachAddress.check}"  onclick="makeAddressTypeEditable(); return false;"/>
                </apex:column>
                <apex:column headerValue="Address Type">
                    <apex:outputLabel value="{!eachAddress.address.Type__c}"   />
                    <apex:outputPanel rendered="{!eachAddress.isEditable}">
                       <!-- Add as  rendered="{!NOT(eachAddress.isEditable)}"
                        <apex:inputField value="{!eachAddress.address.Type__c}" /> 
                        <apex:selectList id="chooseTyoe" value="{!selType}" size="1">
                            <apex:selectOption itemValue="Activation Email" itemLabel="Activation Email"/>
                            <apex:selectOption itemValue="Order Acknowledgement" itemLabel="Order Acknowledgement"/> 
                        </apex:selectList> -->
                    </apex:outputPanel>             
                </apex:column>
                <apex:column headerValue="Account">
                    {!eachAddress.address.Account__r.Name}
                </apex:column>              
                <apex:column headerValue="Address Line1">
                    {!eachAddress.address.Address_Line_1__c}
                </apex:column>
                <apex:column headerValue="Address Line2">
                    {!eachAddress.address.Address_Line_2__c}
                </apex:column>
                <apex:column headerValue="City">
                    {!eachAddress.address.City__c}
                </apex:column>
                <apex:column headerValue="State">
                    {!eachAddress.address.State__c}
                </apex:column>
                <apex:column headerValue="Country">
                    {!eachAddress.address.Country__c}
                </apex:column>
                <apex:column headerValue="Zip">
                    {!eachAddress.address.Zipcode__c}
                </apex:column>
            </apex:pageBlockTable>
        </apex:pageBlock> 
        <!--Added below lines for User Story#S-650069, Task#T-852992 Date:27-Dec-2019, By Thirumal Pandian -->
        <apex:pageBlock title="GU Entitlement Voucher Code contact" id="GURefresh">
            <apex:pageBlockSection >
                <apex:pageblocksectionitem >
                <apex:outputlabel > Contact Name </apex:outputlabel>
                   <!-- <apex:inputField value="{!quote.BigMachines__Opportunity__r.Contact__c}" required="true" /> -->
                    <apex:inputText />
                </apex:pageblocksectionitem>
                <apex:pageblocksectionitem >
                 <apex:outputlabel > Contact Email </apex:outputlabel>
                    <apex:inputText /> 
                </apex:pageblocksectionitem>
            </apex:pageBlockSection>
         </apex:pageBlock> 
        <!--End Story #S-650069, Task#T-852992 -->
        <!-- FOR EDIT -->
        <apex:outputPanel id="popPanel2" >
             <apex:outputPanel rendered="{!showCreateNewPopupFlag1}">             
                <apex:outputPanel styleClass="popupBackground" layout="block" />
                <apex:outputPanel styleClass="custPopup" layout="block">
                     <apex:outputPanel layout="block" style="text-align:center;">
                          <apex:pageBlock title="{!popupTitle}" id="pgTable1">
                              <apex:pageBlockButtons location="bottom">
                                  <apex:commandButton value="Save" action="{!saveAddINFO}" reRender="popPane2, pgblkAddress, panelErrors, pgblkAccountAddress,frmId" status="status" />
                                  <apex:commandButton value="Cancel" onclick="hideCreateNewPopup(); return false;" immediate="true"/>                          
                              </apex:pageBlockButtons>
                              <apex:pageBlockSection columns="8" >                                
                                  <apex:outputField value="{!newAddress.Address_Type__c}" />
                              </apex:pageBlockSection>
                              <apex:pageBlockSection columns="2" id="abc123" >
                                <apex:outputField value="{!newAddress.Address_Line_1__c  }"   rendered="{!newAddress.Address_Type__c  != 'Order Acknowledgement'}"/>
                                <apex:outputField value="{!newAddress.Address2__c}"  rendered="{!newAddress.Address_Type__c  != 'Order Acknowledgement'}"/>
                                <apex:outputField value="{!newAddress.City__c}"  rendered="{!newAddress.Address_Type__c  != 'Order Acknowledgement'}"/>
                                <apex:outputField value="{!newAddress.State__c}"  />
                                <apex:outputField value="{!newAddress.Country__c}"  rendered="{!newAddress.Address_Type__c  != 'Order Acknowledgement'}"/>
                                <apex:outputField value="{!newAddress.Zip_Code__c }" rendered="{!newAddress.Address_Type__c  != 'Order Acknowledgement'}"/>       
                                <apex:inputField value="{!newAddress.Phone__c}" rendered="{!newAddress.Address_Type__c != 'Order Acknowledgement'}"/>
                                <apex:inputField value="{!newAddress.Fax__c}" rendered="{!newAddress.Address_Type__c != 'Order Acknowledgement'}"/> 
                                <apex:inputField value="{!newAddress.Email__c}" required="true" />
                                <apex:inputField value="{!newAddress.Shipping_Method_Name__c}" required="true" rendered="{!newAddress.Address_Type__c  == 'Ship To'}" />
                                <apex:inputField value="{!newAddress.Shipping_Instructions__c}" required="true" rendered="{!newAddress.Address_Type__c  == 'Ship To'}" />
                            </apex:pageBlockSection>
                         </apex:pageBlock>
                    </apex:outputPanel>
                 </apex:outputPanel>
            </apex:outputPanel>
        </apex:outputPanel>
       
        <apex:outputPanel id="popPanel" >
            <apex:outputPanel rendered="{!showCreateNewPopupFlag}">             
                <apex:outputPanel styleClass="popupBackground" layout="block" />
                <apex:outputPanel styleClass="custPopup" layout="block">
                    <apex:pageMessages id="panelErrors"></apex:pageMessages>
                    <apex:outputPanel layout="block" style="text-align:center;">
                        <apex:pageBlock title="{!popupTitle}" id="pgTable">
                            <apex:pageBlockButtons location="bottom">
                                <apex:commandButton value="Save" action="{!createNewAddress}" reRender="popPanel, pgblkAddress, panelErrors, pgblkAccountAddress,frmId" status="status" />
                                <apex:commandButton value="Cancel" onclick="hideCreateNewPopup(); return false;" immediate="true"/>                          
                            </apex:pageBlockButtons>
                            <apex:actionRegion >
                                <apex:pageBlockSection columns="6" > 
                                    END TO : 
                                    <apex:outputLabel value="{!quote.End_User_ID__r.Name}"/>
                                    SOLD TO : 
                                   <apex:outputLabel value="{!quote.Sold_To_Name__r.Name}"/>
                                </apex:pageBlockSection>
                                <apex:pageBlockSection columns="8">
                                <apex:selectRadio value="{!selectedValue}" > 
                                    <apex:selectOption itemValue="Enduser" itemLabel="End user"  >                                       
                                    </apex:selectOption> 
                                    <apex:selectOption itemValue="SoldTo" itemLabel="Sold To" >                                       
                                    </apex:selectOption>
                                    <apex:actionSupport event="onchange"                                                              
                                                            reRender="none" />
                                    </apex:selectRadio> 
                                </apex:pageBlockSection>
                                <apex:pageBlockSection columns="4" >                                
                                    <apex:inputField value="{!accountAdd.Type__c}" required="true">                             
                                        <apex:actionsupport event="onclick"  rerender="abc123,panelErrors" immediate="true" status="status"/>
                                    </apex:inputField>
                                </apex:pageBlockSection>
                                
                            </apex:actionRegion>
                            <apex:outputPanel id="terminator">
                            <!-- <apex:inputField value="{!newAddress.Address__c}" required="true" rendered="{!newAddress.Address_Type__c != 'Order Acknowledgement'}"/>-->
                            <apex:pageBlockSection columns="2" id="abc123" >
                                <apex:inputField value="{!accountAdd.Address_Line_1__c }" required="{!accountAdd.Type__c != 'Order Acknowledgement'}"  rendered="{!accountAdd.Type__c  != 'Order Acknowledgement'}"/>
                                <apex:inputField value="{!accountAdd.Address_Line_2__c}" required="{!accountAdd.Type__c  != 'Order Acknowledgement'}"  rendered="{!accountAdd.Type__c  != 'Order Acknowledgement'}"/>
                                <apex:inputField value="{!accountAdd.City__c}" required="true" rendered="{!accountAdd.Type__c  != 'Order Acknowledgement'}"/>
                                <apex:inputField value="{!accountAdd.State__c}" required="true" rendered="{!accountAdd.Type__c  != 'Order Acknowledgement'}" />
                                <apex:inputField value="{!accountAdd.Country__c}"  required="true" rendered="{!accountAdd.Type__c  != 'Order Acknowledgement'}"/>
                                <apex:inputField value="{!accountAdd.Zipcode__c }" required="true" rendered="{!accountAdd.Type__c  != 'Order Acknowledgement'}"/>       
                                <!--   <apex:inputField value="{!newAddress.Phone__c}" rendered="{!newAddress.Address_Type__c != 'Order Acknowledgement'}"/>
                                <apex:inputField value="{!newAddress.Fax__c}" rendered="{!newAddress.Address_Type__c != 'Order Acknowledgement'}"/> 
                                <apex:inputField value="{!newAddress.Email__c}" required="true" /> -->                  
                            </apex:pageBlockSection>
                                </apex:outputPanel>
                            <apex:commandButton value="Get Address" action="{!getAddress}" Rerender="selAddressPanel,panelErrors" status="status">
                                
                            </apex:commandButton>
                        </apex:pageBlock>
                    </apex:outputPanel>
                    <apex:outputPanel id="selAddressPanel">
                        <apex:outputPanel >   
                            statusCode : {!statusCode}
                            <apex:pageBlock title="Validated Addresses" rendered="{!addressWrap.size>0}">
                                <apex:pageBlockTable value="{!addressWrap}" var="resultAdd">
                                    <apex:variable value="{!0}" var="cnt"/>
                                    <apex:column headerValue="Select" > 
                                        <input type="radio" name="select" onclick="replaceAddress('{!cnt}');"  />                    
                                        <apex:param name="index" value="{!cnt}"/>
                                   <!-- <apex:actionsupport onsubmit="replaceAddress('{!cnt}');" immediate="true" event="onclick" rerender="abc123,panelErrors" status="status"> 
                                        
                                    </apex:actionsupport> -->
                                        <apex:variable var="cnt" value="{!cnt+1}"/> 
                                    </apex:column>                                    
                                    <apex:column headerValue="Address Line1" >
                                        <apex:outputLabel value="{!resultAdd.Wrapaddress.Address_Line_1__c}"></apex:outputLabel>
                                    </apex:column>
                                    <apex:column headerValue="Address Line2" >
                                        <apex:outputLabel value="{!resultAdd.Wrapaddress.Address_Line_2__c }"></apex:outputLabel>
                                    </apex:column>
                                    <apex:column headerValue="City">
                                        <apex:outputLabel value="{!resultAdd.Wrapaddress.City__c   }"></apex:outputLabel>
                                    </apex:column>
                                    <apex:column headerValue="State" >
                                        <apex:outputLabel value="{!resultAdd.Wrapaddress.State__c }"></apex:outputLabel>
                                    </apex:column>
                                    <apex:column headerValue="Country" >
                                        <apex:outputLabel value="{!resultAdd.Wrapaddress.Country__c }"></apex:outputLabel>
                                    </apex:column>
                                    <apex:column headerValue="Zip Code" >
                                        <apex:outputLabel value="{!resultAdd.Wrapaddress.Zipcode__c }"></apex:outputLabel>
                                    </apex:column>
                                </apex:pageBlockTable>
                            </apex:pageBlock>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:outputPanel>
            
            <div style="height:20px;">
                <apex:actionStatus id="status">
                    <apex:facet name="start">    
                        <apex:outputPanel id="popPanel1" >
                            <apex:outputPanel styleClass="popupBackground" layout="block"/>
                            <apex:outputPanel styleClass="custPopup" layout="block">
                                <apex:outputPanel layout="block" style="text-align:center;">
                                    Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                </apex:outputPanel>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:facet>                           
                </apex:actionStatus>
            </div>
        </apex:outputPanel>
        <style type="text/css">
            .custPopup{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 50%;
            padding:10px;
            position: absolute;
            width: 500px;
            margin-left: -250px;
            top:650px;
            }
            .popupBackground{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
            }    
            .example{
            
            }
        </style>
    </apex:form>
</apex:page>