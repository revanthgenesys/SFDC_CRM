<apex:page id="pg"  extensions="ServiceOrderQuoteToolController" title="Service Order Quote Tool" sidebar="false" standardController="BigMachines__Quote__c"  >
    <style type="text/css">
        .custPopup{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 50%;
            padding:10px;
            position: absolute;
            width: 500px;
            margin-left: -250px;
            top:100px;
        }
        .popupBackground{
            background-color:black;
            opacity: 0.20;
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
        }       
        .tableRow{
            font-size:9pt;
        } 
        .activeRow{
            background-color:#FAF4A0;
            font-weight:bold;
        }
        .totalRow{
            font-weight:bold;
        }
        .errorRow{
            background-color:#FF9999;
        }
        .disabled{
            background-color:#F8F9F8;
        }
    </style>
    <script>
        function modalWin(productId, discount) {            
            if (window.showModalDialog) {               
                window.showModalDialog('/apex/SOQuoteTool_TbPopup?id='+ productId + '&discount=' + discount,'name','dialogWidth:500px;dialogHeight:350px');
            } else {
                var left = (screen.width / 2) - 250;
                var top = (screen.height / 2) - 175;                
                window.open('/apex/SOQuoteTool_TbPopup?id='+ productId + '&discount=' + discount,'name','height=350,width=500,toolbar=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,modal=yes,left='+left+',top='+top);
            }
        }
    </script>
    <apex:outputPanel id="jsPanel">
        <script>
            function doCalculationJS(index, sectionType){
                var calculationFlag = '{!quote.Run_Time_Calculations__c}';
                if(calculationFlag == 'true'){                  
                    if(sectionType == 'User Subscription'){
                        doCalculationUS(index, sectionType);
                    }
                    else if(sectionType == 'Port Subscription'){
                        doCalculationPS(index, sectionType);
                    }
                    else if(sectionType == 'Rented Equipment'){
                        doCalculationRE(index, sectionType);
                    }   
                    else if(sectionType == 'Time Based'){
                        doCalculationTB(index, sectionType);
                    }
                    else if(sectionType == 'Transaction Based'){
                        doCalculationTRB(index, sectionType);
                    }
                    else if(sectionType == 'Tier Based'){
                        doCalculationTIB(index, sectionType);
                    }   
                    else if(sectionType == 'Configuration Professional Services'){
                        doCalculationCPS(index, sectionType);
                    }
                    else if(sectionType == 'Client Management'){
                        doCalculationCM(index, sectionType);
                    }   
                    else if(sectionType == 'Customer Subscription'){
                        doCalculationCS(index, sectionType);
                    }
                    else if(sectionType == 'BluIP'){
                        doCalculationBluIP(index, sectionType);
                    }
                }                           
            }
            function scrollToTop(){             
                if('{!isErrorMsg}' == 'true')
                    window.scrollTo(500,0);
            }
        </script>
    </apex:outputPanel>
    <apex:form id="frm">
        <apex:outputPanel layout="none" rendered="{!quote.Offering_Type__c == 'Outbound Engagement'}">
            <apex:actionFunction name="doCalculationOnPeriodChange" action="{!doCalculationOnPeriodChange}" reRender="pgblkUsageFee,pgblkRecFee,pgblkNonRecCharges" status="status" />
            <apex:actionFunction name="saveAJAX" action="{!save}" reRender="pgblkUsageFee,pgblkRecFee,pgblkNonRecCharges,pgMsg,jsPanel,quoteInfo,upfrontApprovalTab" status="status" onComplete="scrollToTop(); return false;"/>
        </apex:outputPanel>
        <apex:outputPanel layout="none" rendered="{!quote.Offering_Type__c != 'Outbound Engagement'}">
            <apex:actionFunction name="doCalculationUS" action="{!doCalculation}" reRender="pgblktblSectionUser" status="statusUS">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationPS" action="{!doCalculation}" reRender="pgblktblSectionUser" status="statusPS">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>        
            <apex:actionFunction name="doCalculationRE" action="{!doCalculation}" reRender="pgblktblSectionRentedEquipment" status="statusRE">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationTB" action="{!doCalculation}" reRender="pgblktblTimeBased" status="statusTB">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationForLocalCommittedMinutes" action="{!doCalculationForLocalCommittedMinutes}" reRender="pgblktblTimeBased" status="statusTB">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>        
            <apex:actionFunction name="doCalculationTRB" action="{!doCalculation}" reRender="pgblktblTransactionBased" status="statusTRB">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationTIB" action="{!doCalculation}" reRender="pgblktblTierBased" status="statusTIB">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationCPS" action="{!doCalculation}" reRender="pgblktblCPS" status="statusCPS">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationCM" action="{!doCalculation}" reRender="pgblktblCM" status="statusCM">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationCS" action="{!doCalculation}" reRender="pgblktblCS" status="statusCS">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationBluIP" action="{!doCalculation}" reRender="pgblktblBluIP" status="statusBluIP">
                <apex:param value="" name="index" assignTo="{!index}" />
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="addRowRE" action="{!addMoreProduct}" reRender="pgblktblSectionRentedEquipment" status="statusRE">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>        
            <apex:actionFunction name="addRowUS" action="{!addMoreProduct}" reRender="pgblktblSectionUser" status="statusUS">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>        
            <apex:actionFunction name="addRowTRB" action="{!addMoreProduct}" reRender="pgblktblTransactionBased" status="statusTRB">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>  
            <apex:actionFunction name="addRowTime" action="{!addMoreProduct}" reRender="pgblktblTimeBased" status="statusTB">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction> 
             <apex:actionFunction name="addRowTier" action="{!addMoreProduct}" reRender="pgblktblTierBased" status="statusTIB">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>   
            <apex:actionFunction name="addRowCPS" action="{!addMoreProduct}" reRender="pgblkCPS" status="statusCPS">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="addRowBluIP" action="{!addMoreProduct}" reRender="pgblkBluIP" status="statusBluIP">
                <apex:param value="" name="index" assignTo="{!index}" />            
                <apex:param value="" name="sectionType" assignTo="{!sectionType}" />
            </apex:actionFunction>
            <apex:actionFunction name="doCalculationOnPeriodChange" action="{!doCalculationOnPeriodChange}" reRender="pgblkRecFee,pgblkNonRecCharges" status="status" />
            <apex:actionFunction name="saveAJAX" action="{!save}" reRender="pgblkRecFee,pgblkNonRecCharges,pgMsg,jsPanel,quoteInfo,upfrontApprovalTab" status="status" onComplete="scrollToTop(); return false;"/>
        </apex:outputPanel>
        
        <apex:outputPanel id="pgMsg">
            <apex:pagemessages />
        </apex:outputPanel>                
        <apex:pageBlock title="{!quote.Offering_Type__c}" id="pgblk">
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved', quote.id == '')}"/>
                <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!OR(AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved', quote.id != ''),$Profile.Name=='General User Access Group SU')}"/>                
                <apex:commandButton value="Clone" action="{!cloneQuote}" status="status" rendered="{!quote.id != ''}"/>
                <apex:commandButton value="Revise" action="{!recall}" status="status" disabled="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Rejected', quote.BigMachines__Status__c != 'Quote Approved')}"/>
                <apex:commandButton value="Return to Opportunity" action="{!cancel}"/>
                <apex:commandButton value="Submit For Approval" rendered="{!OR(quote.BigMachines__Status__c == 'Quote In Progress', quote.BigMachines__Status__c == 'Revision Pending')}" action="{!submitForApproval}" />
                <apex:commandButton value="Submit Order" rendered="{!quote.BigMachines__Status__c == 'Quote Approved'}" action="{!submitOrderBtnHandler}" />
                <apex:commandButton value="Send Contract" action="{!viewContract}" oncomplete="window.open('/apex/loop__looplus?sessionId={!$Api.Session_ID}&eid={!quote.Id}&contactid={!quote.Contact__c}&accountid={!quote.End_User_ID__c}&opportunityid={!quote.BigMachines__Opportunity__c}&filter=ServiceOrder&filtertype=equals');"
                                    rendered="{!(quote.BigMachines__Status__c == 'Quote Approved' || quote.BigMachines__Status__c == 'Order Submitted')}" />
               <!--<apex:commandButton value="Send Contract" action="{!viewContract}" rendered="{!(quote.BigMachines__Status__c == 'Quote Approved' || quote.BigMachines__Status__c == 'Order Submitted')}"/>-->
            </apex:pageBlockButtons>
            <apex:tabPanel switchType="client" selectedTab="quoteTab" id="theTabPanel">
                <apex:tab label="Quote" name="quoteTab" id="quoteTab">
                    <apex:pageBlockSection id="quoteInfo">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Quote Number" for="quoteNumber" />
                            <apex:outputLink id="quoteNumber" value="/{!quote.id}" target="_blank"> {!quote.Quote_Number__c} </apex:outputLink>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Opportunity" for="linkOpp" />
                            <apex:outputLink id="linkOpp" value="/{!quote.BigMachines__Opportunity__c}" target="_blank"> {!quote.BigMachines__Opportunity__r.Name}                              
                            </apex:outputLink>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="End User" for="linkEndUser" />
                            <apex:outputLink id="linkEndUser" value="/{!quote.End_User_ID__c}" target="_blank"> {!quote.End_User_ID__r.Name}                                
                            </apex:outputLink>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Sold To" for="linkST" />
                            <apex:outputLink id="linkST" value="/{!quote.Sold_To_Name__c}" target="_blank"> {!quote.Sold_To_Name__r.Name}                               
                            </apex:outputLink>
                        </apex:pageBlockSectionItem>                        
                        <apex:repeat value="{!$ObjectType.BigMachines__Quote__c.FieldSets.Service_order_quote_header_fields}" var="f">                            
                            <apex:inputField value="{!quote[f]}" rendered="{!AND(f.label == 'Minimum (Fees) Period', opp.Lines_of_Businesses__c  != 'Premier Edition Cloud', opp.Lines_of_Businesses__c != 'Self Service')}" />
                            <apex:outputField value="{!quote[f]}" rendered="{!AND((f.label == 'Minimum (Fees) Period'), OR(opp.Lines_of_Businesses__c  == 'Premier Edition Cloud', opp.Lines_of_Businesses__c == 'Self Service'))}" />                          
                            <apex:inputField value="{!quote[f]}" rendered="{!AND(f.required, f.label != 'Quote Number', f.label != 'Minimum (Fees) Period')}" />
                            <apex:outputField value="{!quote[f]}" rendered="{!AND(NOT(f.required), f.label != 'Quote Number', f.label != 'Minimum (Fees) Period')}" />                            
                        </apex:repeat>
                        <apex:inputField value="{!quote.Treat_SO_as_PO__c}"/> 
                        <apex:selectList value="{!quote.Run_Time_Calculations__c}" size="1" label="Calculation Mode">
                            <apex:SelectOption itemLabel="Bulk Mode"  itemValue="false"/>
                            <apex:SelectOption itemLabel="Line Level Mode"  itemValue="true"/>                          
                        </apex:selectList>  
						<apex:outputField value="{!quote.Top_Play__c}"/> 
						<apex:outputField value="{!quote.Offer__c}"/> 
                    </apex:pageBlockSection>
                    <apex:pageBlockSection title="Totals" rendered="{!blnIsHybridCustomer}">
                        <apex:inputField label="Commited Monthly Recurring Revenue" value="{!quote.CMRR__c}" />
                        <apex:inputField label="Annual Contract Value" value="{!quote.Annual_Contract_Value__c}" />
                        <apex:inputField label="Total Contract Value" value="{!quote.Cloud_Total__c}" />  
                        <apex:inputField label="Total Installation Charges" value="{!quote.Setup_Provisioning_Charges__c}" />
                        <apex:inputField value="{!quote.Monthly_Contract_Value__c}" />                                                       
                    </apex:pageBlockSection>
                    <apex:outputPanel layout="none" rendered="{!NOT(blnIsHybridCustomer)}">
                    <apex:pageBlockSection columns="1" title="Mass Update - Update Multiple line items">
                        <apex:pageBlockTable value="{!headerRow}" var="eachRecord" >
                            <apex:column headerValue="Quantity">
                                <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" required="false"/>                                                             
                            </apex:column>
                            <apex:column headerValue="Discount">
                                <apex:inputField value="{!eachRecord.record.Discount__c}" required="false"/>                              
                            </apex:column>  
                            <apex:column >
                                <apex:commandButton value="Update Selected & Calculate" action="{!bulkUpdate}" status="status" reRender="pgblkUsageFee,pgblkRecFee,pgblkNonRecCharges"/>
                            </apex:column>                    
                        </apex:pageBlockTable>
                    </apex:pageBlockSection>                    
                    <apex:pageBlock title="Usage-Based Fees" id="pgblkUsageFee" rendered="{!quote.Offering_Type__c == 'Outbound Engagement'}">
                        <!-- Per Message / Per Minute Pricing -->                        
                        <div style="height:5px;">
                            <apex:actionStatus id="statusPerMsgPerMin">
                                <apex:facet name="start">    
                                    Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                </apex:facet>                           
                            </apex:actionStatus>
                        </div>
                        <apex:pageBlockSection columns="1" id="pgblkPerMsgPerMin" title="Per Message / Per Minute Pricing" rendered="{!renderRransactionBasedSubscriptions}">
                            <apex:pageBlockTable value="{!list_PerMsgPerMin}" var="eachRecord" rowClasses="tableRow">
                                <apex:column styleClass="{!eachRecord.styleClass}">
                                    <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                    <apex:facet name="header">
                                        <apex:commandlink action="{!doCalculation}" rerender="pgblkPerMsgPerMin" status="statusPerMsgPerMin" title="Calculate">
                                            <apex:param value="0" name="index" assignTo="{!index}" />
                                            <apex:param value="Per Message/Per Minute" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                        </apex:commandlink>
                                    </apex:facet>                                                                 
                                </apex:column>
                                <apex:column styleClass="{!eachRecord.styleClass}">
                                    <apex:commandlink action="{!addMoreProduct}" rerender="pgblkPerMsgPerMin" status="statusPerMsgPerMin" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                        <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                        <apex:param value="Per Message/Per Minute" name="sectionType" assignTo="{!sectionType}" />
                                        <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                    </apex:commandlink>
                                </apex:column>
                                <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                    <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                    <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                    <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                    <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                    <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                </apex:column>                   
                                <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                    <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                    <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                        <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                        <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                            <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                    &nbsp;&nbsp;
                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                </apex:column>             
                                <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                    <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                        <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                    </apex:selectList>
                                </apex:column>             
                                <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                    <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                    <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                </apex:column>
                                <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                    <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                </apex:column>
                                <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                    <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                </apex:column>
                                <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                    <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                        <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                    <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                        <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                    </apex:outputText>
                                </apex:column>                                                                                                                                            
                            </apex:pageBlockTable>                  
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                    
                    <apex:pageBlock title="Recurring Fees" id="pgblkRecFee">                        
                        <apex:outputPanel rendered="{!quote.Offering_Type__c == 'Outbound Engagement'}">
                            <!-- Short And Long Code Fees -->                        
                            <div style="height:5px;">
                                <apex:actionStatus id="statusShortLongCodeRec">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkShortLongCodeRec" title="Short And Long Code Fees" rendered="{!blnShowShortLongCodeRec}">
                                <apex:pageBlockTable value="{!list_ShortLongCodeRec}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkShortLongCodeRec" status="statusShortLongCodeRec" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="Short/Long Code Recurring Fees" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkShortLongCodeRec" status="statusShortLongCodeRec" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="Short/Long Code Recurring Fees" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}"/>
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            
                            <!-- Software Or Platform Licensing -->                   
                            <div style="height:5px;">
                                <apex:actionStatus id="statusSWPlatformLicensing">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkSWPlatformLicensing" title="Software Or Platform Licensing" rendered="{!blnShowSWPlatformLicensing}">
                                <apex:pageBlockTable value="{!list_SWPlatformLicensing}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkSWPlatformLicensing" status="statusSWPlatformLicensing" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="SW/Platform Licensing" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkSWPlatformLicensing" status="statusSWPlatformLicensing" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="SW/Platform Licensing" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}"/>
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            
                            <!-- Per Seat Pricing -->         
                            <div style="height:5px;">
                                <apex:actionStatus id="statusPerSeatPricing">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkPerSeatPricing" title="Per Seat Pricing" rendered="{!renderPerSeatPricingBase}">
                                <apex:pageBlockTable value="{!perSeatPricingBase}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkPerSeatPricing" status="statusPerSeatPricing" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="Per Seat Pricing (Base Options)" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkPerSeatPricing" status="statusPerSeatPricing" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="Per Seat Pricing (Base Options)" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}"/>
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            
                            <apex:pageBlockSection columns="1" id="pgblkSupport" title="Customer Care" rendered="{!renderSupportSubscriptions}">
                                <apex:pageBlockTable value="{!supportSubscriptions}" var="eachRecord" rowClasses="tableRow">          
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}"/>                                    
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Level Of Support">
                                        <apex:selectList value="{!eachRecord.record.Level_Of_Support__c}" size="1" rendered="{!eachRecord.detailRow}">
                                            <apex:SelectOptions value="{!supportOptionList}" />
                                        </apex:selectList>                                        
                                    </apex:column>                                 
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Support}" var="f">
                                        <apex:column headerValue="{!f.label}"  styleClass="{!eachRecord.styleClass}">
                                            <apex:outputField value="{!eachRecord.record[f]}" rendered="{!AND(NOT(f.required), eachRecord.detailRow, f.label != 'Extended Price Per Month',f.label != 'Discount %')}" />
                                            <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(f.required, eachRecord.detailRow)}" required="false"/>
                                            &nbsp;&nbsp;
                                            <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                            </apex:outputText>
                                        </apex:column>
                                        <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                            </apex:outputText>                                          
                                        </apex:outputPanel>
                                    </apex:repeat>                      
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!quote.Offering_Type__c != 'Outbound Engagement'}">
                            <div style="height:5px;">
                                <apex:actionStatus id="statusUS">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkSectionUser" title="Per Seat Pricing [Concurrent, Named, or Supplemental Usage (e.g. per seat) for Agents or Administrators]" rendered="{!renderUserSubscriptions}">
                                <apex:pageBlockTable value="{!userSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblSectionUser">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationUS(0, 'User Subscription');" width="15px" height="15px"/>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowUS('{!eachRecord.index}', 'User Subscription');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                                                        
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity (# of ports/minutes/users) or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'User Subscription');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'User Subscription');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />           
                                        <br/>                             
                                        <!--                       
                                        <apex:outputText value="Connection charge (per leg) - PEC  .018 per Minute" rendered="{!AND(NOT(eachRecord.detailRow), quote.Offering_Type__c == 'Premier Edition')}" style="font-size:7pt;" />
                                         -->                                       
                                    </apex:column>                                
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_User_Subscription_Fields}" var="f">
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.index > -1}">                                      
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Net Unit Price',f.label != 'Product', f.label != 'Device/Services', f.label != 'Extended Price Per Month')}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />                                              
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(f.required, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'User Subscription');" />                                                
                                                </apex:outputPanel>
                                                <apex:selectList value="{!eachRecord.record[f]}" rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies)}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'User Subscription');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                                </apex:selectList>
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'User Subscription');" />
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>                                            
                                                </apex:outputPanel>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>   
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                           
                                            </apex:outputPanel>                                          
                                        </apex:column>                                    
                                    </apex:repeat>                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>                        
                            <div style="height:5px;">
                                <apex:actionStatus id="statusPS">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkSectionPort" title="Port Subscription"  rendered="{!renderPortSubscriptions}">
                                <apex:pageBlockTable value="{!portSubscriptions}" var="eachRecord"  rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}"/>  
                                        
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationPS(0, 'Port Subscription');" width="15px" height="15px"/>
                                        </apex:facet>                                  
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowRE('{!eachRecord.index}', 'Port Subscription');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity (# of ports/minutes/users) or Yes/No">                             
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Port Subscription');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Port Subscription');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                       
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Port_Subscription}" var="f">
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:selectList value="{!eachRecord.record[f]}" rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies)}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Port Subscription');" style="width:150px">
                                                <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                            </apex:selectList>
                                            <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Product', f.label != 'Device/Services', f.label != 'Extended Price Per Month')}">
                                                <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />
                                                <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationPS('{!eachRecord.index}', 'Port Subscription');" />                                            
                                            </apex:outputPanel>                                        
                                            <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                    <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                </apex:outputPanel>
                                                &nbsp;&nbsp;
                                                <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />
                                                <apex:inputField value="{!eachRecord.record[f]}" rendered="{!eachRecord.isListPriceEditable}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Port Subscription');" />
                                                <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                            </apex:outputPanel>
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                            </apex:outputText>   
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                           
                                            </apex:outputPanel>  
                                        </apex:column>
                                    </apex:repeat>                      
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            <div style="height:5px;">
                                <apex:actionStatus id="statusCS">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkSectionCustomer" title="Customer Subscription"  rendered="{!renderCustomerSubscriptions}">
                                <apex:pageBlockTable value="{!customerSubscriptions}" var="eachRecord"  rowClasses="tableRow" id="pgblktblCS">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}" />                                    
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity (# of ports/minutes/users) or Yes/No">                             
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false"  />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false"  />                                    
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                             
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Customer_Subscription_Service_Order}" var="f">                                    
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:outputField value="{!eachRecord.record[f]}" rendered="{!AND(NOT(f.required), eachRecord.detailRow, f.label != 'Extended Price Per Month')}" />
                                            <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(f.required, eachRecord.detailRow)}" required="false"/>
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                            </apex:outputText>
                                            &nbsp;&nbsp;
                                            <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>                                        
                                        </apex:column>                                    
                                    </apex:repeat>                      
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            <div style="height:5px;">
                                <apex:actionStatus id="statusRE">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkSectionRentedEquipment" title="Rented Equipment/Communications Circuits/Short Codes - Phone Numbers"  rendered="{!renderRentedEquipmentSubscriptions}">
                                <apex:pageBlockTable value="{!rentedEquipmentSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblSectionRentedEquipment">             
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}"/>                                    
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationRE(0, 'Rented Equipment');" width="15px" height="15px"/>
                                        </apex:facet>
                                    </apex:column>                                
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowRE('{!eachRecord.index}', 'Rented Equipment');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                                                        
                                    </apex:column>               
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity (# of ports/minutes/users) or Yes/No">                         
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Rented Equipment');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Rented Equipment');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                        
                                    </apex:column>                 
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Rented_Equipment_Service_Order}" var="f" >
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.detailRow}">
                                                <apex:selectList value="{!eachRecord.record[f]}" rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies)}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Rented Equipment');" style="width:150px">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                                </apex:selectList>
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Device/Services', f.label != 'Product', f.label != 'Extended Price Per Month')}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Rented Equipment');"/>                                             
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!eachRecord.isListPriceEditable}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Rented Equipment');"/>
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                                </apex:outputPanel>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                     
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                           
                                            </apex:outputPanel>                                         
                                        </apex:column>
                                    </apex:repeat>                      
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            <apex:pageBlockSection columns="1" id="pgblkSectionSupport" title="Support" rendered="{!renderSupportSubscriptions}">
                                <apex:pageBlockTable value="{!supportSubscriptions}" var="eachRecord" rowClasses="tableRow">          
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}"/>                                    
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Level Of Support">
                                        <apex:selectList value="{!eachRecord.record.Level_Of_Support__c}" size="1" rendered="{!eachRecord.detailRow}">
                                            <apex:SelectOptions value="{!supportOptionList}" />
                                        </apex:selectList>                                        
                                    </apex:column>                                 
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Support}" var="f">
                                        <apex:column headerValue="{!f.label}"  styleClass="{!eachRecord.styleClass}">
                                            <apex:outputField value="{!eachRecord.record[f]}" rendered="{!AND(NOT(f.required), eachRecord.detailRow, f.label != 'Extended Price Per Month',f.label != 'Discount %')}" />
                                            <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(f.required, eachRecord.detailRow)}" required="false"/>
                                            &nbsp;&nbsp;
                                            <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                            <apex:outputPanel rendered="{!f.label == 'Level Of Support'}">
                                                <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                                <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                            </apex:outputPanel>
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                            </apex:outputText>
                                        </apex:column>
                                        <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                            <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                            </apex:outputText>                                           
                                        </apex:outputPanel>
                                    </apex:repeat>                      
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            <apex:pageBlockSection columns="1" id="pgblkTimeBased" title="Per Minute Pricing [Pricing based on Minutes (or other time unit) of Use]" rendered="{!renderTimeBasedSubscriptions}">
                                <apex:pageBlockTable value="{!timeBasedSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblTimeBased">            
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}" disabled="{!eachRecord.autoSelected}"/>                                    
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationTB(0, 'Time Based');" width="15px" height="15px"/>
                                        </apex:facet>
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}">                                 
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowTime('{!eachRecord.index}', 'Time Based');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}"  headerValue="Quantity (# of ports/minutes/users) or Yes/No">                                
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Time Based');" />
                                        <!--  
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, eachRecord.includeInCMRR)}" required="false" onchange="doCalculationForLocalCommittedMinutes('{!eachRecord.index}', 'Time Based');" />
                                        -->                                    
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Time Based');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow), NOT(eachRecord.autoSelected))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow), NOT(eachRecord.autoSelected))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                    
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Quote_Time_Based}" var="f">
                                        <apex:column headerValue="{!f.label}"  styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.detailRow}">
                                                <apex:selectList value="{!eachRecord.record[f]}" rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies, NOT(eachRecord.autoSelected))}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Time Based');" style="width:150px">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                                </apex:selectList>
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Product', f.label != 'Device/Services', f.label != 'Extended Price Per Month')}">                                              
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(f.required, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationUS('{!eachRecord.index}', 'Time Based');"/>
                                                    <!--
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(f.required, eachRecord.includeInCMRR, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationForLocalCommittedMinutes('{!eachRecord.index}', 'Time Based');"/>
                                                    -->                                              
                                                    <apex:outputText value="%" rendered="{!AND(eachRecord.isListPriceInDiscount, f.label == 'Net Unit Price')}"/>
                                                </apex:outputPanel>                                         
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">                                                
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Time Based');"/>
                                                    <!-- 
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!AND(eachRecord.isListPriceEditable, eachRecord.includeInCMRR, NOT(eachRecord.autoSelected))}" required="false" onchange="doCalculationForLocalCommittedMinutes('{!eachRecord.index}', 'Time Based');"/>
                                                    -->                                                
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>                                              
                                                </apex:outputPanel> 
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                           
                                            </apex:outputPanel> 
                                        </apex:column>
                                    </apex:repeat>                      
                                </apex:pageBlockTable>              
                            </apex:pageBlockSection>            
                            <div style="height:5px;">
                                <apex:actionStatus id="statusTRB">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkTransactionBased" title="Transaction Based [Transactional Pricing (e.g per message or completed transaction)]" rendered="{!renderRransactionBasedSubscriptions}">                           
                                <apex:pageBlockTable value="{!transactionBasedSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblTransactionBased">               
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}"/>                                    
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationTRB(0, 'Transaction Based');" width="15px" height="15px"/>
                                        </apex:facet>
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowTRB('{!eachRecord.index}', 'Transaction Based');" rendered="{!eachRecord.index > -1}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}"  headerValue="Quantity (# of ports/minutes/users) or Yes/No">                    
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Transaction Based');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Transaction Based');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                    
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Quote_Transaction_Based}" var="f">
                                        <apex:column headerValue="{!f.label}"  styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.detailRow}">
                                                <apex:selectList value="{!eachRecord.record[f]}" rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies)}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Transaction Based');" style="width:150px">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                                </apex:selectList>
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Device/Services', f.label != 'Product', f.label != 'Extended Price Per Month')}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Transaction Based');"/>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>
                                                 <apex:outputPanel rendered="{!f.label == 'Product'}">                                          
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>                                            
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!eachRecord.isListPriceEditable}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Transaction Based');"/>
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                                </apex:outputPanel>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText> 
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                          
                                            </apex:outputPanel> 
                                        </apex:column>
                                    </apex:repeat>                      
                                </apex:pageBlockTable>              
                            </apex:pageBlockSection>
                            <div style="height:5px;">
                                <apex:actionStatus id="statusTIB">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkTierBased" title="Tier Based [Usage Pricing based on Tiers]" rendered="{!renderTierSubscriptions}">
                                <apex:pageBlockTable value="{!tierSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblTierBased">                
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.detailRow}"/>                                    
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationTIB(0, 'Tier Based');" width="15px" height="15px"/>
                                        </apex:facet>
                                    </apex:column> 
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowTier('{!eachRecord.index}', 'Tier Based');" rendered="{!AND(eachRecord.detailRow, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}"  headerValue="Quantity (# of ports/minutes/users) or Yes/No"> 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Tier Based');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Tier Based');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                        
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Quote_Tier_Based}" var="f" id="repeat">
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}" id="tierColumn">
                                            <apex:outputPanel rendered="{!eachRecord.detailRow}" id="pnl">
                                                <apex:selectList value="{!eachRecord.record[f]}"  rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies)}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Tier Based');" style="width:150px">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}"/>                                          
                                                </apex:selectList>
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Device/Services', f.label != 'Product', f.label != 'Extended Price Per Month')}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required )}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Tier Based');" id="lbl1"/>                                             
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>                                            
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!eachRecord.isListPriceEditable}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Tier Based');"/>
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                                </apex:outputPanel>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText> 
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                          
                                            </apex:outputPanel> 
                                        </apex:column>
                                    </apex:repeat>                    
                                </apex:pageBlockTable>              
                            </apex:pageBlockSection>
                            <!--BluIP-->
                            <div style="height:5px;">
                                <apex:actionStatus id="statusBluIP">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkBluIP" title="Virtual PBX - Powered by BluIP" rendered="{!blnShowBluIP}">
                                <apex:pageBlockTable value="{!list_BluIP}" var="eachRecord" rowClasses="tableRow" id="pgblktblBluIP">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}"/>                                     
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationBluIP(0, 'BluIP');" width="15px" height="15px"/>
                                        </apex:facet>                                   
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowBluIP('{!eachRecord.index}', 'BluIP');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}"  headerValue="Quantity (# of ports/minutes/users) or Yes/No">                            
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'BluIP');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'BluIP');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                        
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_BluIP}" var="f">
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.index > -1}">                              
                                                <apex:outputPanel rendered="{!f.label != 'Product'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />                                              
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'BluIP');"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>  
                                            </apex:outputPanel>                                        
                                        </apex:column>                                    
                                    </apex:repeat>                                                                                              
                                </apex:pageBlockTable>                 
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                    </apex:pageBlock>                    
                    <apex:pageBlock title="Non Recurring Fees" id="pgblkNonRecCharges">
                        <apex:outputPanel rendered="{!quote.Offering_Type__c == 'Outbound Engagement'}">
                            <!-- Short And Long Code Fees -->                        
                            <div style="height:5px;">
                                <apex:actionStatus id="statusShortLongCodeNonRec">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkShortLongCodeNonRec" title="Short And Long Code Fees" rendered="{!blnShowShortLongCodeNonRec}">
                                <apex:pageBlockTable value="{!list_ShortLongCodeNonRec}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkShortLongCodeNonRec" status="statusShortLongCodeNonRec" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="Short/Long Code Non Recurring Fees" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkShortLongCodeNonRec" status="statusShortLongCodeNonRec" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="Short/Long Code Non Recurring Fees" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}"/>
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            
                            <!-- Software Or Platform Implementation -->                        
                            <div style="height:5px;">
                                <apex:actionStatus id="statusSWPlatformImplementation">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkSWPlatformImplementation" title="Software Or Platform Implementation" rendered="{!blnShowSWPlatformImplementation}">
                                <apex:pageBlockTable value="{!list_SWPlatformImplementation}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkSWPlatformImplementation" status="statusSWPlatformImplementation" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="SW/Platform Implementation" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkSWPlatformImplementation" status="statusSWPlatformImplementation" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="SW/Platform Implementation" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            
                            <!-- Transaction-Based Pricing -->                        
                            <div style="height:5px;">
                                <apex:actionStatus id="statusTransactionBased">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkTransactionBased" title="Transaction-Based Pricing" rendered="{!renderRransactionBasedSubscriptions}">
                                <apex:pageBlockTable value="{!transactionBasedSubscriptions}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkTransactionBased" status="statusTransactionBased" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="Transaction Based" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkTransactionBased" status="statusTransactionBased" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="Transaction Based" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                            
                            <!-- Professional Services Implementation -->                        
                            <div style="height:5px;">
                                <apex:actionStatus id="statusPSImplementation">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkPSImplementation" title="Professional Services Implementation" rendered="{!renderPSImplementation}">
                                <apex:pageBlockTable value="{!psImplementation}" var="eachRecord" rowClasses="tableRow">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}" disabled="{!eachRecord.autoSelected}" />                                    
                                        <apex:facet name="header">
                                            <apex:commandlink action="{!doCalculation}" rerender="pgblkPSImplementation" status="statusPSImplementation" title="Calculate">
                                                <apex:param value="0" name="index" assignTo="{!index}" />
                                                <apex:param value="Professional Services Implementation" name="sectionType" assignTo="{!sectionType}" />
                                                <apex:image url="{!$Resource.RefreshIcon}" width="15px" height="15px"/>    
                                            </apex:commandlink>
                                        </apex:facet>                                                                 
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:commandlink action="{!addMoreProduct}" rerender="pgblkPSImplementation" status="statusPSImplementation" rendered="{!AND(eachRecord.index > -1,  OR(eachRecord.hasDevcies, eachRecord.showAddSign))}">
                                            <apex:param value="{!eachRecord.index}" name="index" assignTo="{!index}" />
                                            <apex:param value="Professional Services Implementation" name="sectionType" assignTo="{!sectionType}" />
                                            <apex:image url="{!$Resource.PlusSign}" width="15px;" height="15px"/>
                                        </apex:commandlink>
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}" headerValue="Quantity or Yes/No">                                 
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>                                    
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                           
                                    </apex:column>                   
                                    <apex:column headerValue="Product" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Product__c}" rendered="{!eachRecord.isProductNameEditable}" />
                                        <apex:outputPanel rendered="{!NOT(eachRecord.isProductNameEditable)}">
                                            <apex:outputField value="{!eachRecord.record.Product__c}"  rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                            <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record.Product__c}</u> </span>
                                            </apex:outputPanel>
                                        </apex:outputPanel>
                                        &nbsp;&nbsp;
                                        <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!eachRecord.detailRow}"/>
                                    </apex:column>             
                                    <apex:column headerValue="Devices/Services" styleClass="{!eachRecord.styleClass}">
                                        <apex:selectList value="{!eachRecord.record.Device__c}" rendered="{!eachRecord.hasDevcies}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Professional Services');" style="width:150px" disabled="{!eachRecord.autoSelected}">
                                            <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}" />
                                        </apex:selectList>
                                    </apex:column>             
                                    <apex:column headerValue="List Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.List_Price__c}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                                                                   
                                        <apex:inputField value="{!eachRecord.record.List_Price__c}" rendered="{!AND(eachRecord.isListPriceEditable, NOT(eachRecord.autoSelected))}" required="false"/>
                                        <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                    </apex:column>
                                    <apex:column headerValue="Metric" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputField value="{!eachRecord.record.Metric__c}" />
                                    </apex:column>
                                    <apex:column headerValue="Discount" styleClass="{!eachRecord.styleClass}">
                                        <apex:inputField value="{!eachRecord.record.Discount__c}" rendered="{!AND(NOT(eachRecord.autoSelected), eachRecord.isDiscountable)}" required="false"/>
                                    </apex:column>
                                    <apex:column headerValue="Net Price" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price">
                                            <apex:param value="{!eachRecord.record.Net_Unit_Price__c}"/>
                                        </apex:outputText>
                                    </apex:column>
                                    <apex:column headerValue="Extended Price Per Period" styleClass="{!eachRecord.styleClass}">
                                        <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month">
                                            <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                        </apex:outputText>
                                    </apex:column>                                                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!quote.Offering_Type__c != 'Outbound Engagement'}">
                            <div style="height:5px;">
                                <apex:actionStatus id="statusTB">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>                           
                            <div style="height:5px;">
                                <apex:actionStatus id="statusCPS">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkCPS" title="PS Implementation [PS Implementation or other Installation type charges]" rendered="{!renderProfServicesSubscription}">
                                <apex:pageBlockTable value="{!configurationProfServicesSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblCPS">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}"/>                                     
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationCPS(0, 'Configuration Professional Services');" width="15px" height="15px"/>
                                        </apex:facet>                                   
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowCPS('{!eachRecord.index}', 'Configuration Professional Services');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}"  headerValue="Quantity (# of ports/minutes/users) or Yes/No">                            
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Configuration Professional Services');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Configuration Professional Services');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                        
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Confg_Prof_Services}" var="f">
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.index > -1}">        
                                                <apex:selectList value="{!eachRecord.record[f]}"  rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies, f.label != 'Extended Price Per Month')}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Configuration Professional Services');" style="width:150px">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}"/>                                          
                                                </apex:selectList>                              
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price',f.label != 'Net Unit Price',f.label != 'Product', f.label != 'Device/Services',f.label != 'Extended Price Per Month')}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />                                              
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Configuration Professional Services');"/>
                                                    </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>                                            
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                              
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!eachRecord.isListPriceEditable}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Configuration Professional Services');"/>
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                                </apex:outputPanel> 
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>   
                                            </apex:outputPanel>                                        
                                        </apex:column>                                    
                                    </apex:repeat>             
                                    <apex:column headerValue="Extended Price" styleClass="{!eachRecord.styleClass}" >
                                        <apex:outputField value="{!eachRecord.record.Extended_Price_Per_Month__c}" />                                                                             
                                    </apex:column>                                                                                               
                                </apex:pageBlockTable>                 
                            </apex:pageBlockSection>
                            <div style="height:5px;">
                                <apex:actionStatus id="statusCM">
                                    <apex:facet name="start">    
                                        Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                                    </apex:facet>                           
                                </apex:actionStatus>
                            </div>
                            <apex:pageBlockSection columns="1" id="pgblkCM" title="Client Management [Hourly Rates for Support Requests]" rendered="{!renderClientManagementSubscription}">
                                <apex:pageBlockTable value="{!clientManagementSubscriptions}" var="eachRecord" rowClasses="tableRow" id="pgblktblCM">
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:inputCheckBox value="{!eachRecord.selected}" rendered="{!eachRecord.index > -1}"/>                                    
                                        <apex:facet name="header">
                                            <apex:image url="{!$Resource.RefreshIcon}" title="Calculate" style="cursor:pointer;" onclick="doCalculationCM(0, 'Client Management');" width="15px" height="15px"/>
                                        </apex:facet>                       
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}">
                                        <apex:image url="{!$Resource.PlusSign}" onclick="addRowRE('{!eachRecord.index}', 'Client Management');" rendered="{!AND(eachRecord.index > -1, eachRecord.hasDevcies)}" width="15px;" height="15px" style="cursor:pointer;"/>                                    
                                    </apex:column>
                                    <apex:column styleClass="{!eachRecord.styleClass}"  headerValue="Quantity (# of ports/minutes/users) or Yes/No">            
                                        <apex:inputField value="{!eachRecord.record.BigMachines__Quantity__c}" rendered="{!AND(eachRecord.productOption != 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Client Management');" />
                                        <apex:inputField value="{!eachRecord.record.Product_Option__c}" rendered="{!AND(eachRecord.productOption == 'Yes/No', eachRecord.detailRow)}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Client Management');" />
                                        <apex:commandButton value="Save" onclick="saveAJAX(); return false;" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id != '',NOT(eachRecord.detailRow))}"/>       
                                        <apex:commandButton value="Save" action="{!save}" rendered="{!AND(quote.BigMachines__Status__c != 'Quote Approval Pending',quote.BigMachines__Status__c != 'Quote Approved',quote.id == '',NOT(eachRecord.detailRow))}"/>
                                        <apex:image url="{!$Resource.ErrorIcon}" rendered="{!eachRecord.styleClass == 'errorRow'}" title="{!eachRecord.errorMsg}" width="15px;" height="15px" />                                                                        
                                    </apex:column>
                                    <apex:repeat value="{!$ObjectType.BigMachines__Quote_Product__c.FieldSets.Service_Order_Client_Management}" var="f">
                                        <apex:column headerValue="{!f.label}" styleClass="{!eachRecord.styleClass}">
                                            <apex:outputPanel rendered="{!eachRecord.index > -1}">     
                                                <apex:selectList value="{!eachRecord.record[f]}"  rendered="{!AND(f.label == 'Device/Services', eachRecord.hasDevcies)}" size="1"  onchange="doCalculationJS('{!eachRecord.index}', 'Client Management');" style="width:150px">
                                                    <apex:SelectOptions value="{!mapProductVsProductDevices[eachRecord.record.BigMachines__Product__c]}"/>                                          
                                                </apex:selectList>                                  
                                                <apex:outputPanel rendered="{!AND(f.label != 'List Price', f.label != 'Net Unit Price',f.label != 'Product', f.label != 'Device/Services', f.label != 'Extended Price Per Month')}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(f.required)}" />                                              
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!f.required}" required="false" onchange="doCalculationJS('{!eachRecord.index}', 'Client Management');"/>                                                
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'Product'}">                                           
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.showOrderAsLink)}" />
                                                    <apex:outputPanel rendered="{!eachRecord.showOrderAsLink}" >
                                                        <span onclick="modalWin('{!eachRecord.record.BigMachines__Product__c}', '{!eachRecord.record.Discount__c}')" style="cursor:pointer;"> <u>{!eachRecord.record[f]}</u> </span>
                                                    </apex:outputPanel>
                                                    &nbsp;&nbsp;
                                                    <apex:image url="{!$Resource.HelpIcon}" width="15px;" height="15px" style="cursor:pointer;" title="{!eachRecord.productDescription}" rendered="{!AND(f.label == 'Product', eachRecord.detailRow)}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel rendered="{!f.label == 'List Price'}">
                                                    <apex:outputField value="{!eachRecord.record[f]}" rendered="{!NOT(eachRecord.isListPriceEditable)}" />                                              
                                                    <apex:inputField value="{!eachRecord.record[f]}" rendered="{!eachRecord.isListPriceEditable}" required="false"/>
                                                    <apex:outputText value="%" rendered="{!eachRecord.isListPriceInDiscount}"/>
                                                </apex:outputPanel>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Net Unit Price" rendered="{!f.label == 'Net Unit Price'}">
                                                    <apex:param value="{!eachRecord.record.Net_Unit_Price__c}" />
                                                </apex:outputText>
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>   
                                            </apex:outputPanel>                                        
                                            <apex:outputPanel rendered="{!NOT(eachRecord.detailRow)}">                                         
                                                <apex:outputText value="{0, number, ###,##0.0000}" label="Extended Price Per Month" rendered="{!f.label == 'Extended Price Per Month'}">
                                                    <apex:param value="{!eachRecord.record.Extended_Price_Per_Month__c}" />
                                                </apex:outputText>                                         
                                            </apex:outputPanel>                                          
                                        </apex:column>                                    
                                    </apex:repeat>                                                                                                            
                                </apex:pageBlockTable>                  
                            </apex:pageBlockSection>
                        </apex:outputPanel>
                        <apex:pageBlockSection title="Totals">
                            <apex:outputField label="Professional Services" value="{!quote.CPS_Total__c}" rendered="{!quote.Offering_Type__c = 'Outbound Engagement'}"/>
                            <apex:outputField label="Non Recurring Fees" value="{!quote.Non_Recurring_Fees__c}" rendered="{!quote.Offering_Type__c = 'Outbound Engagement'}"/>
                            <apex:outputField label="Commited Monthly Recurring Revenue" value="{!quote.CMRR__c}"/>
                            <apex:outputField label="Annual Contract Value" value="{!quote.Annual_Contract_Value__c}"/>
                            <apex:outputField label="Total Contract Value" value="{!quote.Cloud_Total__c}"/>  
                            <apex:outputField label="Total Installation Charges" value="{!quote.Setup_Provisioning_Charges__c}" rendered="{!quote.Offering_Type__c != 'Outbound Engagement'}"/>
                            <apex:outputField value="{!quote.Monthly_Contract_Value__c}" />                                                       
                        </apex:pageBlockSection>                
                    </apex:pageBlock>
                    </apex:outputPanel>
                </apex:tab>
                <apex:tab label="DAP Details" name="DAPFieldsTab" id="DAPFieldsTab">
                    <apex:pageBlockSection columns="1">
                        <apex:repeat value="{!$ObjectType.BigMachines__Quote__c.FieldSets.Service_Order_Quote_DAP_Fields}" var="f">
                            <apex:inputField value="{!quote[f]}" rendered="{!f.required}" style="width:100%" />
                            <apex:outputField value="{!quote[f]}" rendered="{!NOT(f.required)}" />                  
                        </apex:repeat>
                    </apex:pageBlockSection>                    
                </apex:tab>
                <apex:tab label="Special Offer/Legal Terms" name="specialOfferTab" id="specialOfferTab">
                    <apex:pageBlockSection columns="1">
                        <apex:repeat value="{!$ObjectType.BigMachines__Quote__c.FieldSets.Service_Order_Special_Offer_Tab_Fields}" var="f">
                            <apex:inputField value="{!quote[f]}" rendered="{!f.required}" style="width:100%" />
                            <apex:outputField value="{!quote[f]}" rendered="{!NOT(f.required)}" />                  
                        </apex:repeat>
                    </apex:pageBlockSection>                    
                </apex:tab>
                <apex:tab label="Upfront Approval" name="upfrontApprovalTab" id="upfrontApprovalTab">
                    <apex:iframe src="/apex/cloud_upfront_approval?id={!quote.id}" scrolling="false" id="upfrontApproval"/>
                </apex:tab>
                <apex:tab label="Order Info" name="orderInfoTab" id="orderInfoTab">   
                    <apex:pageBlockSection columns="2">
                        <apex:inputField value="{!quote.Order_PO_Number__c}"/>
                        <apex:inputField value="{!quote.Order_PO_Date__c}"/>
                        <apex:inputField value="{!quote.Order_PO_Received_Date__c}"/>
                        <!--<apex:pageBlockSectionItem >
                            <apex:outputLabel value="Attach PO (Optional)"/>
                            <apex:inputFile value="{!objAttachment.body}" filename="{!objAttachment.name}"/>
                        </apex:pageBlockSectionItem>-->
                    </apex:pageBlockSection>
                </apex:tab>
                <apex:tab label="Output Options" name="OutputOptionsTab" id="OutputOptionsTab" rendered="{!quote.BigMachines__Status__c == 'Quote Approved' || quote.BigMachines__Status__c == 'Order Submitted'}">   
                    <apex:pageBlockSection columns="2">
                        <apex:inputField value="{!quote.Hide_Discount__c}"/>
                        <apex:inputField value="{!quote.Hide_Totals__c}"/>
                        <apex:inputField value="{!quote.Proposal_Date__c}"/>
                    </apex:pageBlockSection>                            
                </apex:tab>
        </apex:tabPanel>
        </apex:pageBlock>       
    </apex:form>
    <!-- Billing Address Section -->
    <apex:include pageName="OrderAddressCloud" rendered="{!NOT(ISBLANK(quote.id)) && 
              (quote.BigMachines__Status__c == 'Quote Approved' || quote.BigMachines__Status__c == 'Order Submitted')}"/>
    <apex:relatedList list="ProcessSteps" ></apex:relatedList>     
    <div style="height:15px;">
        <apex:actionStatus id="status">
            <apex:facet name="start">    
                <apex:outputPanel id="popPanel">
                    <apex:outputPanel styleClass="popupBackground" layout="block"/>
                    <apex:outputPanel styleClass="custPopup" layout="block">
                        <apex:outputPanel layout="block" style="text-align:center;">
                            Please wait ... &nbsp; <apex:image value="/img/loading.gif"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:facet>                           
        </apex:actionStatus>
    </div>
    <script>
        var button = document.getElementsByName('piSubmit');
        if(button != null && button.length > 0)
            button[0].style.display = 'none';
    </script>
</apex:page>